<html lang="en"><head><title>SurviveJS - Adding Hashes to Filenames</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
Even though our build generates fine now, the naming it uses is a little problematic. It doesn&#x27;t allow us to leverage client level cache effectively as there&#x27;s no easy way to tell whether or not a file has changed. Cache invalidation can be achieved by including a hash to filenames.

Webpack providâ€¦"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/hash.jpg);"></div><h1 class="post__heading">Adding Hashes to Filenames</h1><div class="header-extra"><a href="https://pixabay.com/en/root-potato-hash-healthy-vegetable-1112017/">ctowner (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="search-nav--header">Search</h4><input id="search"/><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/webpack-compared">Webpack Compared</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/why-webpack">Why Webpack?</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing-with-webpack">Developing with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/configuring-hmr">Configuring Hot Module Replacement</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/linting">Linting JavaScript</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/splitting-configuration">Splitting the Configuration</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/handling-styles">Handling Styles with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/loading">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/eliminating-unused-css">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/linting">Linting CSS</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/understanding-loaders">Understanding Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/loading-images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/loading-fonts">Loading Fonts</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/writing-loaders">Writing Loaders</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building-with-webpack">Building with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/enabling-sourcemaps">Enabling Sourcemaps</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/splitting-bundles">Splitting Bundles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/code-splitting">Code Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/processing-with-babel">Processing with Babel</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/cleaning-build">Cleaning the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/hosting-on-github-pages">Hosting on GitHub Pages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimizing-build">Optimizing the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing-build/minifying">Minifying the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing-build/setting-environment-variables">Setting Environment Variables</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Adding Hashes to Filenames</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing-build/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/advanced-techniques">Advanced Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/consuming-packages">Consuming Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/authoring-packages">Authoring Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/configuring-react">Configuring React</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/appendices">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/searching-with-react">Searching with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/configuring-hmr-with-react">Configuring Hot Module Replacement with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/writing-eslint-plugins">Writing ESLint Plugins</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/customizing-eslint">Customizing ESLint</a></li></ul><div><div class="buy-container"><a href="/webpack/introduction"><img class="sidebar-cover" src="/assets/img/webpack_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img class="sidebar-cover" src="/assets/img/react_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/ajv-interview">ajv - The Fastest JSON Schema Validator - Interview with Evgeny Poberezkin</a></blockquote><div class="chapter-content"><p>Even though our build generates fine now, the naming it uses is a little problematic. It doesn&#39;t allow us to leverage client level cache effectively as there&#39;s no easy way to tell whether or not a file has changed. Cache invalidation can be achieved by including a hash to filenames.</p>
<p>Webpack provides <strong>placeholders</strong> for this purpose. These strings are used to attach specific information to webpack output. The most useful ones are:</p>
<ul>
<li><code>[path]</code> - Returns the file path.</li>
<li><code>[name]</code> - Returns the file name.</li>
<li><code>[ext]</code> - Returns the extension.</li>
<li><code>[hash]</code> - Returns the build hash.</li>
<li><code>[chunkhash]</code> - Returns a chunk specific hash.</li>
<li><code>[contenthash]</code> - Returns a hash specific to content. This is available for <code>ExtractTextPlugin</code> only.</li>
</ul>
<p>It is preferable to use particularly <code>hash</code> and <code>chunkhash</code> only for production purposes as hashing won&#39;t do much good during development.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you want shorter hashes, it is possible to slice <code>hash</code> and <code>chunkhash</code> using syntax like this: <code>[chunkhash:8]</code>. Instead of a hash like <code>8c4cbfdb91ff93f3f3c5</code> this would yield <code>8c4cbfdb</code>.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>There are more options available and you can even modify the hashing and digest type as discussed at <a href="https://www.npmjs.com/package/loader-utils#interpolatename">loader-utils</a> documentation.</blockquote><h2 class="header"><a class="header-anchor" href="#using-placeholders" id="using-placeholders"></a><span class="text">Using Placeholders</span><a class="header-anchor-select" href="#using-placeholders">#</a></h2>
<p>Assuming we have configuration like this:</p>
<pre><code class="lang-javascript"><span class="token punctuation" >{</span>
  output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    path<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >,</span>
    filename<span class="token punctuation" >:</span> <span class="token string" >'[name].[chunkhash].js'</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
<span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</code></pre>
<p>Webpack would generate filenames like these:</p>
<pre><code class="lang-bash">app.d587bbd6e38337f5accd.js
vendor.dc746a5db4ed650296e1.js
</code></pre>
<p>If the file contents related to a chunk are different, the hash will change as well, thus invalidating the cache. More accurately, the browser will send a new request for the new file. This means if only <code>app</code> bundle gets updated, only that file needs to be requested again.</p>
<p>An alternate way to achieve the same result would be to generate static filenames and invalidate the cache through a querystring (i.e., <code>app.js?d587bbd6e38337f5accd</code>). The part behind the question mark will invalidate the cache. According to <a href="http://www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/">Steve Souders</a>, attaching the hash to the filename is the more performant way to go.</p>
<h2 class="header"><a class="header-anchor" href="#setting-up-hashing" id="setting-up-hashing"></a><span class="text">Setting Up Hashing</span><a class="header-anchor-select" href="#setting-up-hashing">#</a></h2>
<p>There are a few places in the build we need to tweak to generate proper hashes. The production branch of the main configuration needs a tweak:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>env<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>env <span class="token operator" >===</span> <span class="token string" >'production'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >return</span> <span class="token function" >merge</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
      common<span class="token punctuation" >,</span>
      <span class="token punctuation" >{</span>
        output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
<div class="leanpub-insert">
          chunkFilename<span class="token punctuation" >:</span> <span class="token string" >'scripts/[chunkhash].js'</span><span class="token punctuation" >,</span>
          filename<span class="token punctuation" >:</span> <span class="token string" >'[name].[chunkhash].js'</span><span class="token punctuation" >,</span>
</div>

          <span class="token comment" spellcheck="true">// Tweak this to match your GitHub project name</span>
          publicPath<span class="token punctuation" >:</span> <span class="token string" >'/webpack-demo/'</span><span class="token punctuation" >,</span>
        <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >clean</span><span class="token punctuation" >(</span>PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>

  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>To make the extracted CSS pick up a hash, we should set <code>contenthash</code> for it. We cannot use <code>chunkhash</code> given it is derived based on the entry and the CSS of the project belongs to the same entry chunk as the application code.</p>
<p>This means a change made to the application code would invalidate CSS hash as well or vice versa. Instead, relying on a hash generated based on the CSS content is a stable way to go.</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

exports<span class="token punctuation" >.</span>extractCSS <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>paths<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >return</span> <span class="token punctuation" >{</span>
    module<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token comment" spellcheck="true">// Output extracted CSS to a file</span>
<div class="leanpub-delete">
      <span class="token keyword" >new</span> <span class="token class-name" >ExtractTextPlugin</span><span class="token punctuation" >(</span><span class="token string" >'[name].css'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
<div class="leanpub-insert">
      <span class="token keyword" >new</span> <span class="token class-name" >ExtractTextPlugin</span><span class="token punctuation" >(</span><span class="token string" >'[name].[contenthash].css'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
    <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
</code></pre>
<p>If you generate a build now (<code>npm run build</code>), you should see something like this:</p>
<pre><code class="lang-bash">Hash: b28400513ee1f3cc4b58
Version: webpack 2.2.0
Time: 2361ms
                                       Asset       Size  Chunks             Chunk Names
             scripts/a3e8b000643b89a4baf0.js  179 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
                 app.0463c61541fc45af4e1d.js  612 bytes       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
              vendor.0088a151dee083233d21.js    21.1 kB       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
    app.581584c83549d8a12e1752ef1aab2cb8.css    2.23 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
         scripts/a3e8b000643b89a4baf0.js.map  850 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
             app.0463c61541fc45af4e1d.js.map    5.31 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
app.581584c83549d8a12e1752ef1aab2cb8.css.map  117 bytes       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
          vendor.0088a151dee083233d21.js.map     261 kB       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
                                  index.html  391 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>5<span class="token punctuation" >]</span> ./~/react/react.js 56 bytes <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>15<span class="token punctuation" >]</span> ./app/component.js 504 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>16<span class="token punctuation" >]</span> ./app/main.css 41 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >..</span>.
</code></pre>
<p>Our files have neat hashes now. To prove that it works for styling, you could try altering <em>app/main.css</em> and see what happens to the hashes when you rebuild.</p>
<p>There&#39;s one problem, though. If you change the application code, it will invalidate the vendor file as well! Solving this requires extracting something known as a <strong>manifest</strong>, but before that we can improve the way the production build handles module ids.</p>
<h2 class="header"><a class="header-anchor" href="#enabling-hashedmoduleidsplugin-" id="enabling-hashedmoduleidsplugin-"></a><span class="text">Enabling <code>HashedModuleIdsPlugin</code></span><a class="header-anchor-select" href="#enabling-hashedmoduleidsplugin-">#</a></h2>
<p>As you might remember, webpack uses number based ids for the module code it generates. The problem is that they are difficult to work with and can lead to difficult to debug issues particularly with hashing. Just as we did with the development setup earlier, we can perform a simplification here as well.</p>
<p>Webpack provides <code>HashedModuleIdsPlugin</code> that is like <code>NamedModulesPlugin</code> except it hashes the result and hides the path information. This keeps module ids stable as they aren&#39;t derived based on order. We sacrifice a few bytes for a cleaner setup, but the trade-off is well worth it.</p>
<p>The change required is simple. Tweak the configuration as follows:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>env<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>env <span class="token operator" >===</span> <span class="token string" >'production'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >return</span> <span class="token function" >merge</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
      common<span class="token punctuation" >,</span>
      <span class="token punctuation" >{</span>
        output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
          chunkFilename<span class="token punctuation" >:</span> <span class="token string" >'scripts/[chunkhash].js'</span><span class="token punctuation" >,</span>
          filename<span class="token punctuation" >:</span> <span class="token string" >'[name].[chunkhash].js'</span><span class="token punctuation" >,</span>

          <span class="token comment" spellcheck="true">// Tweak this to match your GitHub project name</span>
          publicPath<span class="token punctuation" >:</span> <span class="token string" >'/webpack-demo/'</span><span class="token punctuation" >,</span>
        <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
        plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
          <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>HashedModuleIdsPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
        <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
</div>
      <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >setFreeVariable</span><span class="token punctuation" >(</span>
        <span class="token string" >'process.env.NODE_ENV'</span><span class="token punctuation" >,</span>
        <span class="token string" >'production'</span>
      <span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>

  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>As you can see in the build output, the difference is negligible.</p>
<pre><code class="lang-bash">Hash: b2f4e0352d585455643d
Version: webpack 2.2.0
Time: 2407ms
                                       Asset       Size  Chunks             Chunk Names
             scripts/ce7751bddf1a96fd3916.js  181 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
                 app.a6c5ea36c65dd4a199a2.js  651 bytes       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
              vendor.e4b418854dc5baf0b331.js    21.5 kB       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
    app.581584c83549d8a12e1752ef1aab2cb8.css    2.23 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
         scripts/ce7751bddf1a96fd3916.js.map  858 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
             app.a6c5ea36c65dd4a199a2.js.map    5.36 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
app.581584c83549d8a12e1752ef1aab2cb8.css.map  117 bytes       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
          vendor.e4b418854dc5baf0b331.js.map     262 kB       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
                                  index.html  391 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>1Q41<span class="token punctuation" >]</span> ./app/main.css 41 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>2twT<span class="token punctuation" >]</span> ./app/index.js 591 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>3imu<span class="token punctuation" >]</span> ./~/react/lib/ReactPureComponent.js 1.32 kB <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >..</span>.
</code></pre>
<p>Note how the output has changed, though. Instead of numbers, you can see hashes. But this is expected given the change we made.</p>
<h2 class="header"><a class="header-anchor" href="#separating-a-manifest" id="separating-a-manifest"></a><span class="text">Separating a Manifest</span><a class="header-anchor-select" href="#separating-a-manifest">#</a></h2>
<p>When webpack writes bundles, it writes something known as a <strong>manifest</strong> as well. You can find it in the generated <em>vendor</em> bundle in this project. The manifest describes what files webpack should load. It is possible to extract it and start loading the files of our project faster instead of having to wait for the <em>vendor</em> bundle to be loaded.</p>
<p>This is the root of our problem. If the hashes webpack generates change, then the manifest will change as well. As a result, the contents of the vendor bundle will change and it will become invalidated. The problem can be eliminated by extracting the manifest to a file of its own or by writing it inline to the <em>index.html</em> of the project.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>To understand how a manifest is generated in greater detail, <a href="https://stackoverflow.com/questions/39548175/can-someone-explain-webpacks-commonschunkplugin/39600793">read the technical explanation at Stack Overflow</a>.</blockquote><h3 class="header"><a class="header-anchor" href="#extracting-a-manifest" id="extracting-a-manifest"></a><span class="text">Extracting a Manifest</span><a class="header-anchor-select" href="#extracting-a-manifest">#</a></h3>
<p>We have done most of the work already when we set up <code>extractBundles</code>. To extract the manifest, a single change is required:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>env<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>env <span class="token operator" >===</span> <span class="token string" >'production'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >return</span> <span class="token function" >merge</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
      parts<span class="token punctuation" >.</span><span class="token function" >extractBundles</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
        <span class="token punctuation" >{</span>
          name<span class="token punctuation" >:</span> <span class="token string" >'vendor'</span><span class="token punctuation" >,</span>
          entries<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'react'</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span>
        <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
        <span class="token punctuation" >{</span>
          name<span class="token punctuation" >:</span> <span class="token string" >'manifest'</span><span class="token punctuation" >,</span>
        <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</div>
      <span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >generateSourcemaps</span><span class="token punctuation" >(</span><span class="token string" >'source-map'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >lintJavaScript</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span> paths<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >extractCSS</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >purifyCSS</span><span class="token punctuation" >(</span>PATHS<span class="token punctuation" >.</span>app<span class="token punctuation" >)</span><span class="token punctuation" >,</span>
    <span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>

  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>If you build the project now (<code>npm run build</code>), you should see something like this:</p>
<pre><code class="lang-bash">Hash: 0a76a94d8d4b0e5663c1
Version: webpack 2.2.0
Time: 2391ms
                                       Asset       Size  Chunks             Chunk Names
         scripts/a749f8b7a6c990eff5b2.js.map  865 bytes    0, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
             scripts/a749f8b7a6c990eff5b2.js  183 bytes    0, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
                 app.4f0c0cbd6f41c9bb18af.js  653 bytes    2, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
            manifest.c8e56c8521a89cb22c6f.js    1.53 kB       3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  manifest
    app.581584c83549d8a12e1752ef1aab2cb8.css    2.23 kB    2, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
              vendor.e9b7f566aa067b34ae88.js    20.1 kB    1, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
          vendor.e9b7f566aa067b34ae88.js.map     249 kB    1, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
             app.4f0c0cbd6f41c9bb18af.js.map    5.36 kB    2, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
app.581584c83549d8a12e1752ef1aab2cb8.css.map  117 bytes    2, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
        manifest.c8e56c8521a89cb22c6f.js.map    14.1 kB       3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  manifest
                                  index.html  484 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>1Q41<span class="token punctuation" >]</span> ./app/main.css 41 bytes <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>2twT<span class="token punctuation" >]</span> ./app/index.js 591 bytes <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>3imu<span class="token punctuation" >]</span> ./~/react/lib/ReactPureComponent.js 1.32 kB <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >..</span>.
</code></pre>
<p>This simple change gave us a separate file that contains the manifest. Given we are using <em>html-webpack-plugin</em>, it generates a reference to <em>index.html</em> automatically so we don&#39;t have to worry about loading it.</p>
<p>Plugins, such as <a href="https://www.npmjs.com/package/inline-manifest-webpack-plugin">inline-manifest-webpack-plugin</a> and <a href="https://www.npmjs.com/package/html-webpack-inline-chunk-plugin">html-webpack-inline-chunk-plugin</a>, work with <em>html-webpack-plugin</em> and allow you to write the manifest within <em>index.html</em> in order to avoid a request.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>To get a better idea of the manifest contents, comment out <code>parts.minify()</code> and examine the resulting manifest. You should see something familiar there.</blockquote><p>Try adjusting <em>app/index.js</em> and see how the hashes change. This time around it should <strong>not</strong> invalidate the vendor bundle, and only the manifest and app bundle names should be different like this:</p>
<pre><code class="lang-bash">Hash: a8a9c6cca7360f1c485b
Version: webpack 2.2.0
Time: 2546ms
                                       Asset       Size  Chunks             Chunk Names
         scripts/a749f8b7a6c990eff5b2.js.map  865 bytes    0, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
             scripts/a749f8b7a6c990eff5b2.js  183 bytes    0, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
                 app.78b72e65a8da23867cd4.js  673 bytes    2, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
            manifest.263a1718ddc308cec749.js    1.53 kB       3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  manifest
    app.581584c83549d8a12e1752ef1aab2cb8.css    2.23 kB    2, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
              vendor.e9b7f566aa067b34ae88.js    20.1 kB    1, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
          vendor.e9b7f566aa067b34ae88.js.map     249 kB    1, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
             app.78b72e65a8da23867cd4.js.map    5.44 kB    2, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
app.581584c83549d8a12e1752ef1aab2cb8.css.map  117 bytes    2, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
        manifest.263a1718ddc308cec749.js.map    14.1 kB       3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  manifest
                                  index.html  484 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>1Q41<span class="token punctuation" >]</span> ./app/main.css 41 bytes <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>2twT<span class="token punctuation" >]</span> ./app/index.js 613 bytes <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>3imu<span class="token punctuation" >]</span> ./~/react/lib/ReactPureComponent.js 1.32 kB <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >..</span>.
</code></pre>
<blockquote class="tip"><i class="icon-attention-circled"></i>In order to integrate with asset pipelines, you can consider using plugins like <a href="https://www.npmjs.com/package/chunk-manifest-webpack-plugin">chunk-manifest-webpack-plugin</a>, <a href="https://www.npmjs.com/package/webpack-manifest-plugin">webpack-manifest-plugin</a>, <a href="https://www.npmjs.com/package/webpack-assets-manifest">webpack-assets-manifest</a>, or <a href="https://www.npmjs.com/package/webpack-rails-manifest-plugin">webpack-rails-manifest-plugin</a>. These solutions emit JSON that maps the original asset path to the new one.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>One more way to improve the build further would be to load popular dependencies, such as React, through a CDN. That would decrease the size of the vendor bundle even further while adding an external dependency on the project. The idea is that if the user has hit the CDN earlier, caching can kick in just like here.</blockquote><h2 class="header"><a class="header-anchor" href="#using-records" id="using-records"></a><span class="text">Using Records</span><a class="header-anchor-select" href="#using-records">#</a></h2>
<p>As mentioned in the <em>Splitting Bundles</em> chapter, plugins such as <code>AggressiveSplittingPlugin</code> use <strong>records</strong> to implement caching. The approaches discussed above are still valid, but records go one step further.</p>
<p>Records are used for storing module ids across separate build. The gotcha is that you need to store this file some way. If you build locally, one option is to include it to your version control.</p>
<p>To generate a <em>records.json</em> file, adjust the configuration as follows:</p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>env<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>env <span class="token operator" >===</span> <span class="token string" >'production'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >return</span> <span class="token function" >merge</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
      common<span class="token punctuation" >,</span>
      <span class="token punctuation" >{</span>
        output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
          chunkFilename<span class="token punctuation" >:</span> <span class="token string" >'scripts/[chunkhash].js'</span><span class="token punctuation" >,</span>
          filename<span class="token punctuation" >:</span> <span class="token string" >'[name].[chunkhash].js'</span><span class="token punctuation" >,</span>

          <span class="token comment" spellcheck="true">// Tweak this to match your GitHub project name</span>
          publicPath<span class="token punctuation" >:</span> <span class="token string" >'/webpack-demo/'</span><span class="token punctuation" >,</span>
        <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
        plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
          <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>HashedModuleIdsPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
        <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
        recordsPath<span class="token punctuation" >:</span> <span class="token string" >'records.json'</span><span class="token punctuation" >,</span>
</div>
      <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >setFreeVariable</span><span class="token punctuation" >(</span>
        <span class="token string" >'process.env.NODE_ENV'</span><span class="token punctuation" >,</span>
        <span class="token string" >'production'</span>
      <span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>

  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>If you build the project (<code>npm run build</code>), you should see a new file, <em>records.json</em>, at the project root. The next time webpack builds, it will pick up the information and rewrite the file if it has changed.</p>
<p>Records are particularly useful if you have a complex setup with code splitting and want to make sure the split parts gain correct caching behavior. The biggest problem is maintaining the record file.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i><code>recordsInputPath</code> and <code>recordsOutputPath</code> give more granular control over input and output, but often setting only <code>recordsPath</code> is enough.</blockquote><h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Our project has basic caching behavior now. If you try to modify <em>app.js</em> or <em>component.js</em>, the vendor bundle should remain the same. But what&#39;s contained in the build? You can figure that out by <em>Analyzing Build Statistics</em>, as we&#39;ll do in the next chapter.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/firewood.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/optimizing-build/setting-environment-variables">Setting Environment Variables</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/caliper.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/optimizing-build/analyzing-build-statistics">Analyzing Build Statistics</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-webpack">available through Leanpub</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of Webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Analyzing Build Statistics" href="/webpack/optimizing-build/analyzing-build-statistics"><i class="icon-right-open"></i></a><a class="previous-page" title="Setting Environment Variables" href="/webpack/optimizing-build/setting-environment-variables"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><a href="https://github.com/survivejs/webpack" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="position:absolute;top:0;fill:#000;right:0;"><path class="octo-banner" d="M0 0l115 115h15l12 27 108 108V0z" fill="#fff"></path><path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin:130px 106px;transform-origin:130px 106px;"></path><path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"></path></svg></a><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/ajv-interview">ajv - The Fastest JSON Schema Validator - Interview with Evgeny Poberezkin</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-160">SurviveJS - Webpack - v1.6.0</a></li><li><a class="blog-teaser" href="/blog/isomorphic-webpack-interview">isomorphic-webpack - Universal module consumption using webpack - Interview with Gajus Kuizinas</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-150">SurviveJS - Webpack - v1.5.0</a></li><li><a class="blog-teaser" href="/blog/styletron-interview">Styletron - Universal, high-performance JavaScript styles - Interview with Ryan Tsao</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-142">SurviveJS - Webpack - v1.4.2</a></li><li><a class="blog-teaser" href="/blog/inferno-interview">Inferno - Blazing fast, React-like UI library - Interview with Dominic Gannaway</a></li><li><a class="blog-teaser" href="/blog/svelte-interview">Svelte - The magical disappearing UI framework - Interview with Rich Harris</a></li><li><a class="blog-teaser" href="/blog/webpack-merge-interview">webpack-merge - Taming Webpack Configuration - Interview with Juho VepsÃ¤lÃ¤inen</a></li><li><a class="blog-teaser" href="/blog/starratio-interview">StarRatio - Compare JavaScript Projects - Interview with Dmitry Zaets</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
            docsearch({
              apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
              indexName: 'survivejs_webpack',
              inputSelector: '#search',
              debug: false
            });
          </script></div></main></body></html>