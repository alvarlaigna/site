<html lang="en"><head><title>Extending with Loaders</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
As we’ve seen so far, loaders are one of the building blocks of webpack. If you want to load an asset, you’ll most likely need to set up a matching loader definition. Even though there are a lot of available loaders, it is possible you are missing one fitting your purposes.

I will show you next ho…"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/loader.jpg);"></div><h1 class="post__heading">Extending with Loaders</h1><div class="header-extra"><a href="https://pixabay.com/en/volvo-wheel-loaders-machine-906771/">jannebjo (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="search-nav--header">Search</h4><input id="search"/><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/foreword">Foreword</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/preface">Preface</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/what-is-webpack">What is Webpack?</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing">Developing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/configuring-hmr">Configuring Hot Module Replacement</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/linting">Linting JavaScript</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/composing-configuration">Composing Configuration</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/styling">Styling</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/loading">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/autoprefixing">Autoprefixing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/eliminating-unused-css">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/linting">Linting CSS</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading">Loading</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/fonts">Loading Fonts</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/javascript">Loading JavaScript</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building">Building</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/source-maps">Source Maps</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/splitting-bundles">Splitting Bundles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/code-splitting">Code Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/tidying-up">Tidying Up</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimizing">Optimizing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/minifying">Minifying</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/tree-shaking">Tree Shaking</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/setting-environment-variables">Setting Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/adding-hashes-to-filenames">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/separating-manifest">Separating a Manifest</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/performance">Performance</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/output">Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/targets">Build Targets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/library-output">Library Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/multiple-pages">Multiple Pages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/server-side-rendering">Server Side Rendering</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/techniques">Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/dynamic-loading">Dynamic Loading</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/web-workers">Web Workers</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/i18n">Internationalization</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/testing">Testing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/deploying">Deploying Applications</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/packages">Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/consuming">Consuming Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/authoring">Authoring Packages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/extending">Extending</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Extending with Loaders</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/plugins">Extending with Plugins</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/conclusion">Conclusion</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/appendices">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/comparison">Comparison of Build Tools</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/searching-with-react">Searching with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/hmr-with-react">Hot Module Replacement with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/customizing-eslint">Customizing ESLint</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/troubleshooting">Troubleshooting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/glossary">Glossary</a></li></ul><div><div class="buy-container"><a href="/webpack/introduction"><img class="sidebar-cover" src="/assets/img/webpack_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img class="sidebar-cover" src="/assets/img/react_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/code-quality-interview">Code Quality - Interview with João Caxaria</a></blockquote><div class="chapter-content"><p>As we’ve seen so far, loaders are one of the building blocks of webpack. If you want to load an asset, you’ll most likely need to set up a matching loader definition. Even though there are a lot of <a href="https://webpack.js.org/loaders/">available loaders</a>, it is possible you are missing one fitting your purposes.</p>
<p>I will show you next how to develop a couple of small loaders. But before that we’ll discuss how to debug them in isolation.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>The <a href="https://webpack.js.org/api/loaders/">official documentation</a> covers the loader API in detail.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>If you want a good starting point for a standalone loader or plugin project, consider using <a href="https://github.com/webpack-contrib/webpack-defaults">webpack-defaults</a>. It provides an opinionated starting point that comes with linting, testing, and other goodies.</blockquote><h2 class="header"><a class="header-anchor" href="#debugging-loaders-with-loader-runner-" id="debugging-loaders-with-loader-runner-"></a><span class="text">Debugging Loaders with <em>loader-runner</em></span><a class="header-anchor-select" href="#debugging-loaders-with-loader-runner-">#</a></h2>
<p><a href="https://www.npmjs.com/package/loader-runner">loader-runner</a> allows you to run loaders without webpack making it a good tool for learning more about loader development. Install it first:</p>
<pre><code class="lang-bash">npm <span class="token function" >install</span> loader-runner --save-dev
</code></pre>
<p>To have something to test with, set up a loader that returns twice what’s passed to it like this:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript">module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>input<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >return</span> input <span class="token operator" >+</span> input<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>Set up a file to process:</p>
<p><strong>demo.txt</strong></p>
<pre><code>foobar
</code></pre><p>There’s nothing webpack specific in the code yet. The next step is to run the loader through <em>loader-runner</em>:</p>
<p><strong>run-loader.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >const</span> fs <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'fs'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >const</span> <span class="token punctuation" >{</span> runLoaders <span class="token punctuation" >}</span> <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'loader-runner'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token function" >runLoaders</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
    resource<span class="token punctuation" >:</span> <span class="token string" >'./demo.txt'</span><span class="token punctuation" >,</span>
    loaders<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      path<span class="token punctuation" >.</span><span class="token function" >resolve</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'./loaders/demo-loader'</span><span class="token punctuation" >)</span>
    <span class="token punctuation" >]</span>
    readResource<span class="token punctuation" >:</span> fs<span class="token punctuation" >.</span>readFile<span class="token punctuation" >.</span><span class="token function" >bind</span><span class="token punctuation" >(</span>fs<span class="token punctuation" >)</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token keyword" >function</span><span class="token punctuation" >(</span>err<span class="token punctuation" >,</span> result<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >if</span><span class="token punctuation" >(</span>err<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      <span class="token keyword" >return</span> console<span class="token punctuation" >.</span><span class="token function" >error</span><span class="token punctuation" >(</span>err<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>

    console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation" >(</span>result<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>If you run the script now (<code>node run-loader.js</code>), you should see output like this:</p>
<pre><code class="lang-javascript"><span class="token punctuation" >{</span> result<span class="token punctuation" >:</span> <span class="token punctuation" >[</span> <span class="token string" >'foobar\nfoobar\n'</span> <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
  resourceBuffer<span class="token punctuation" >:</span> <span class="token operator" >&lt;</span>Buffer <span class="token number" >66</span> 6f 6f <span class="token number" >62</span> <span class="token number" >61</span> <span class="token number" >72</span> 0a<span class="token operator" >></span><span class="token punctuation" >,</span>
  cacheable<span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
  fileDependencies<span class="token punctuation" >:</span> <span class="token punctuation" >[</span> <span class="token string" >'./demo.txt'</span> <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
  contextDependencies<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token punctuation" >]</span> <span class="token punctuation" >}</span>
</code></pre>
<p>The output tells the <code>result</code> of the processing, the resource that was processed as a buffer, and other meta information that’s less interesting in this case. This is enough to develop more complicated loaders.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you want to capture the output to a file, use either <code>fs.writeFileSync(&#39;./output.txt&#39;, result.result)</code> or its asynchronous version as discussed in <a href="https://nodejs.org/api/fs.html">Node documentation</a>.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>It is possible to refer to loaders installed to the local project by name instead of resolving a full path to them. Example: <code>loaders: [&#39;raw-loader&#39;]</code>.</blockquote><h2 class="header"><a class="header-anchor" href="#implementing-an-asynchronous-loader" id="implementing-an-asynchronous-loader"></a><span class="text">Implementing an Asynchronous Loader</span><a class="header-anchor-select" href="#implementing-an-asynchronous-loader">#</a></h2>
<p>Even though you can implement a lot of loaders using the synchronous interface, there are times when asynchronous calculation is required. You might be integrating a third party package for example.</p>
<p>The example above can be adapted to asynchronous form by using webpack specific API through <code>this.async()</code>. Webpack sets this and the function returns a callback following Node conventions (error first, result second). Tweak as follows:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript">module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>input<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >const</span> callback <span class="token operator" >=</span> <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token keyword" >async</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  <span class="token function" >callback</span><span class="token punctuation" >(</span><span class="token keyword" >null</span><span class="token punctuation" >,</span> input <span class="token operator" >+</span> input<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>Running the demo script (<code>node run-loader.js</code>) again should give exactly the same result as before. To raise an error during execution, try the following:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript">module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>input<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >const</span> callback <span class="token operator" >=</span> <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token keyword" >async</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  <span class="token function" >callback</span><span class="token punctuation" >(</span><span class="token keyword" >new</span> <span class="token class-name" >Error</span><span class="token punctuation" >(</span><span class="token string" >'Demo error'</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>The result should contain <code>Error: Demo error</code> with a stack trace showing where the error originates.</p>
<h2 class="header"><a class="header-anchor" href="#returning-only-output" id="returning-only-output"></a><span class="text">Returning Only Output</span><a class="header-anchor-select" href="#returning-only-output">#</a></h2>
<p>One way to use loaders is to use them to output code. You could have implementation like this:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript">module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >return</span> <span class="token string" >'foobar'</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>But what’s the point? You can pass to loaders through webpack entries. Instead of pointint to pre-existing files as you would in majority of the cases, you could pass to a loader that generates code dynamically. Even though a special case, it is good to be aware of the technique.</p>
<h2 class="header"><a class="header-anchor" href="#passing-options-to-loaders" id="passing-options-to-loaders"></a><span class="text">Passing Options to Loaders</span><a class="header-anchor-select" href="#passing-options-to-loaders">#</a></h2>
<p>In order to control loader behavior, often you want to pass specific options to a loader. To demonstrate this, the runner needs a small tweak:</p>
<p><strong>run-loader.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token function" >runLoaders</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
    resource<span class="token punctuation" >:</span> <span class="token string" >'./demo.txt'</span><span class="token punctuation" >,</span>
    loaders<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
<div class="leanpub-delete">
      path<span class="token punctuation" >.</span><span class="token function" >resolve</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'./loaders/demo-loader'</span><span class="token punctuation" >)</span>
</div>
<div class="leanpub-insert">
      <span class="token punctuation" >{</span>
        loader<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >resolve</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'./loaders/demo-loader'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
        options<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
          text<span class="token punctuation" >:</span> <span class="token string" >'demo'</span><span class="token punctuation" >,</span>
        <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</div>
    <span class="token punctuation" >]</span>
    readResource<span class="token punctuation" >:</span> fs<span class="token punctuation" >.</span>readFile<span class="token punctuation" >.</span><span class="token function" >bind</span><span class="token punctuation" >(</span>fs<span class="token punctuation" >)</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>To capture the option, we need to use <a href="https://www.npmjs.com/package/loader-utils">loader-utils</a>. It has been designed to parse loader options and queries. Install it:</p>
<pre><code class="lang-bash">npm <span class="token function" >install</span> loader-utils --save-dev
</code></pre>
<p>To connect it the loader, set it to concatenate the passed input and the <code>text</code> option:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >const</span> loaderUtils <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'loader-utils'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>input<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >const</span> <span class="token punctuation" >{</span> text <span class="token punctuation" >}</span> <span class="token operator" >=</span> loaderUtils<span class="token punctuation" >.</span><span class="token function" >getOptions</span><span class="token punctuation" >(</span><span class="token keyword" >this</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword" >return</span> input <span class="token operator" >+</span> text<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>After running (<code>node ./run-loader.js</code>), you should see something like this:</p>
<pre><code class="lang-javascript"><span class="token punctuation" >{</span> result<span class="token punctuation" >:</span> <span class="token punctuation" >[</span> <span class="token string" >'foobar\ndemo'</span> <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
  resourceBuffer<span class="token punctuation" >:</span> <span class="token operator" >&lt;</span>Buffer <span class="token number" >66</span> 6f 6f <span class="token number" >62</span> <span class="token number" >61</span> <span class="token number" >72</span> 0a<span class="token operator" >></span><span class="token punctuation" >,</span>
  cacheable<span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
  fileDependencies<span class="token punctuation" >:</span> <span class="token punctuation" >[</span> <span class="token string" >'./demo.txt'</span> <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
  contextDependencies<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token punctuation" >]</span> <span class="token punctuation" >}</span>
</code></pre>
<p>The result is as expected. You can try to pass more options to the loader or use query parameters to see what happens with different combinations.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>It is a good idea to validate options and rather fail hard than silently if the options aren’t what you expect. <a href="https://www.npmjs.com/package/schema-utils">schema-utils</a> has been designed for this purpose.</blockquote><h2 class="header"><a class="header-anchor" href="#pitch-loaders" id="pitch-loaders"></a><span class="text">Pitch Loaders</span><a class="header-anchor-select" href="#pitch-loaders">#</a></h2>
<p>Webpack evaluates loaders in two phases: pitching and running. If you are used to web event semantics, these map to capturing and bubbling. The idea is that webpack allows you to intercept execution during the pitching (capturing) phase. It goes through the loaders left to right first like this and after that it executes them from right to left.</p>
<p>A pitch loader allows you shape the request and even terminate it. To show how termination works. Adjust the example as follows:</p>
<p><strong>loaders/demo-loader.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >const</span> loaderUtils <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'loader-utils'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>input<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >const</span> <span class="token punctuation" >{</span> text <span class="token punctuation" >}</span> <span class="token operator" >=</span> loaderUtils<span class="token punctuation" >.</span><span class="token function" >getOptions</span><span class="token punctuation" >(</span><span class="token keyword" >this</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword" >return</span> input <span class="token operator" >+</span> text<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
module<span class="token punctuation" >.</span>exports<span class="token punctuation" >.</span>pitch <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>remainingRequest<span class="token punctuation" >,</span> precedingRequest<span class="token punctuation" >,</span> input<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation" >(</span>
    <span class="token string" >'remaining request'</span><span class="token punctuation" >,</span> remainingRequest<span class="token punctuation" >,</span>
    <span class="token string" >'preceding request'</span><span class="token punctuation" >,</span> precedingRequest<span class="token punctuation" >,</span>
    <span class="token string" >'input'</span><span class="token punctuation" >,</span> input
  <span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword" >return</span> <span class="token string" >'pitched'</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>If you run (<code>node ./run-loader.js</code>) now, the pitch loader should log intermediate data and intercept the execution:</p>
<pre><code class="lang-javascript">remaining request <span class="token punctuation" >.</span><span class="token operator" >/</span>demo<span class="token punctuation" >.</span>txt preceding request  input <span class="token punctuation" >{</span><span class="token punctuation" >}</span>
<span class="token punctuation" >{</span> result<span class="token punctuation" >:</span> <span class="token punctuation" >[</span> <span class="token string" >'pitched'</span> <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
  resourceBuffer<span class="token punctuation" >:</span> <span class="token keyword" >null</span><span class="token punctuation" >,</span>
  cacheable<span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
  fileDependencies<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span>
  contextDependencies<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token punctuation" >]</span> <span class="token punctuation" >}</span>
</code></pre>
<p>Besides intercepting, this would have been a good chance to attach metadata to the input. Often the pitching stage isn’t required, but it is good to be aware of it as you will see it in existing loaders.</p>
<h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Writing loaders is fun in the sense that they describe transformations from a format to another. Often you can figure out how to achieve something specific by either studying either the API documentation or the existing loaders.</p>
<p>To recap:</p>
<ul>
<li><em>loader-runner</em> is a valuable tool for understanding how loaders work. Use it for debugging how loaders work.</li>
<li>Webpack <strong>loaders</strong> accept input and produce output based on it.</li>
<li>Loaders can be either synchronous or asynchronous. In the latter case, you should use <code>this.async()</code> webpack API to capture the callback exposed by webpack.</li>
<li>If you want to generate code dynamically for webpack entries, that’s where loaders can come in handy. A loader does not have to accept input. It is acceptable that it returns only output in this case.</li>
<li>Use <strong>loader-utils</strong> to parse possible options passed to a loader and consider validating them using <strong>schema-utils</strong>.</li>
<li>Pitching stage complements the default behavior allowing you to intercept and to attach metadata.</li>
</ul>
<p>I will show you how to write plugins in the next chapter. Plugins allow you to intercept webpack’s execution process and they can be combined with loaders to develop more advanced functionality.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/lens.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/extending">Extending</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/plug.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/extending/plugins">Extending with Plugins</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-webpack">available through Leanpub</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of Webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Extending with Plugins" href="/webpack/extending/plugins"><i class="icon-right-open"></i></a><a class="previous-page" title="Extending" href="/webpack/extending"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><a href="https://github.com/survivejs/webpack" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="position:absolute;top:0;fill:#000;right:0;"><path class="octo-banner" d="M0 0l115 115h15l12 27 108 108V0z" fill="#fff"></path><path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin:130px 106px;transform-origin:130px 106px;"></path><path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"></path></svg></a><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/code-quality-interview">Code Quality - Interview with João Caxaria</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-19">SurviveJS - Webpack - v1.9</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-18">SurviveJS - Webpack - v1.8</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-170">SurviveJS - Webpack - v1.7.0</a></li><li><a class="blog-teaser" href="/blog/unexpected-interview">Unexpected - The Extensible BDD Assertion Toolkit - Interview with Sune Simonsen</a></li><li><a class="blog-teaser" href="/blog/ajv-interview">ajv - The Fastest JSON Schema Validator - Interview with Evgeny Poberezkin</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-160">SurviveJS - Webpack - v1.6.0</a></li><li><a class="blog-teaser" href="/blog/isomorphic-webpack-interview">isomorphic-webpack - Universal module consumption using webpack - Interview with Gajus Kuizinas</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-150">SurviveJS - Webpack - v1.5.0</a></li><li><a class="blog-teaser" href="/blog/styletron-interview">Styletron - Universal, high-performance JavaScript styles - Interview with Ryan Tsao</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
            docsearch({
              apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
              indexName: 'survivejs_webpack',
              inputSelector: '#search',
              debug: false
            });
          </script></div></main></body></html>