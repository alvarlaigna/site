<html lang="en"><head><title>Extending with Plugins</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
Compared to loaders, plugins are a more flexible way to extend webpack. As ExtractTextPlugin shows, sometimes it can make sense to use loaders and plugins together. The great thing about plugins is that they allow you to intercept webpack&#x27;s execution through many hooks and then extend it as you seeâ€¦"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/plug.jpg);"></div><h1 class="post__heading">Extending with Plugins</h1><div class="header-extra"><a href="https://pixabay.com/en/plug-connection-technology-1859827/">qimono (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="search-nav--header">Search</h4><input id="search"/><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/foreword">Foreword</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/preface">Preface</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/what-is-webpack">What is Webpack?</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing">Developing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/configuring-hmr">Configuring Hot Module Replacement</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/linting">Linting JavaScript</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/composing-configuration">Composing Configuration</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/styling">Styling</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/loading">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/autoprefixing">Autoprefixing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/eliminating-unused-css">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/linting">Linting CSS</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading">Loading</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/fonts">Loading Fonts</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/javascript">Loading JavaScript</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building">Building</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/source-maps">Source Maps</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/splitting-bundles">Splitting Bundles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/code-splitting">Code Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/tidying-up">Tidying Up</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimizing">Optimizing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/minifying">Minifying Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/tree-shaking">Tree Shaking</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/setting-environment-variables">Setting Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/adding-hashes-to-filenames">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/separating-manifest">Separating a Manifest</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/performance">Performance</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/output">Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/targets">Build Targets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/library-output">Library Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/multiple-pages">Multiple Pages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/server-side-rendering">Server Side Rendering</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/techniques">Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/dynamic-loading">Dynamic Loading</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/web-workers">Web Workers</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/i18n">Internationalization</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/testing">Testing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/deploying">Deploying Applications</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/packages">Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/consuming">Consuming Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/authoring">Authoring Packages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/extending">Extending</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/loaders">Extending with Loaders</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Extending with Plugins</span></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/conclusion">Conclusion</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/appendices">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/comparison">Comparison of Build Tools</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/searching-with-react">Searching with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/hmr-with-react">Hot Module Replacement with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/customizing-eslint">Customizing ESLint</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/troubleshooting">Troubleshooting</a></li></ul><div><div class="buy-container"><a href="/webpack/introduction"><img class="sidebar-cover" src="/assets/img/webpack_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img class="sidebar-cover" src="/assets/img/react_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/survivejs-webpack-18">SurviveJS - Webpack - v1.8</a></blockquote><div class="chapter-content"><p>Compared to loaders, plugins are a more flexible way to extend webpack. As <code>ExtractTextPlugin</code> shows, sometimes it can make sense to use loaders and plugins together. The great thing about plugins is that they allow you to intercept webpack&#39;s execution through many hooks and then extend it as you see fit. Internally webpack consists of an extensive collection of plugins so understanding the basic idea can be valuable if you want to delve into it.</p>
<p>To show you how a plugin works, I will discuss <a href="https://www.npmjs.com/package/purifycss-webpack">purifycss-webpack</a>. We already used it in this book, so diving into its internals doesn&#39;t hurt. The plugin itself doesn&#39;t do much. It figures out what files to pass to PurifyCSS, lets it process the data, captures the output, and writes it to an asset.</p>
<p>A plugin project can be structured similarly as a loader project, so I won&#39;t delve into the project structure. Instead, I will walk through the plugin portion below.</p>
<h2 class="header"><a class="header-anchor" href="#the-basic-flow-of-webpack-plugins" id="the-basic-flow-of-webpack-plugins"></a><span class="text">The Basic Flow of Webpack Plugins</span><a class="header-anchor-select" href="#the-basic-flow-of-webpack-plugins">#</a></h2>
<p>A webpack plugin is expected to expose an <code>apply</code> method. The way you do that is up to you. The most common way is to set up a function and then attach methods to its <code>prototype</code>. I prefer to return an object from a function and then access plugin <code>options</code> through the closure. In the <code>prototype</code> approach you would have to capture the options to <code>this</code> to access them from your methods. Using ES6 classes is an additional option. The exact approach is up to the coding style you prefer.</p>
<p>Regardless of your approach, you should capture possible options passed by a user, preferably validate them, and then make sure your <code>apply</code> method is ready to go. When webpack runs the plugin, it will pass a <code>compiler</code> object to it. This object exposes webpack&#39;s plugin API and allows you to connect into the hooks it provides. <a href="https://webpack.js.org/pluginsapi/compiler/">The official reference</a> lists all the available hooks.</p>
<p>In this case, we need to intercept only a <code>this-compilation</code> hook that is emitted before <code>compilation</code> event itself. It happens to be the right hook for this particular purpose although it can take a bit of experimentation to figure out which hooks you might need.</p>
<p>The hook will receive a <code>compilation</code> object that gives access to the build. It comes with a series of hooks of its own. In this case using the <code>additional-assets</code> hook is enough as we can go through the compiled chunks there and perform our logic.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Loaders have a dirty access to <code>compiler</code> and <code>compilation</code> through underscore (<code>this._compiler</code>/<code>this._compilation</code>). You could write arbitrary files through them and make them do things that might be left to plugins.</blockquote><h2 class="header"><a class="header-anchor" href="#understanding-purifycssplugin-in-detail" id="understanding-purifycssplugin-in-detail"></a><span class="text">Understanding <code>PurifyCSSPlugin</code> in Detail</span><a class="header-anchor-select" href="#understanding-purifycssplugin-in-detail">#</a></h2>
<p>The PurifyCSS plugin exposes a small interface to the user. Consider the example below:</p>
<pre><code class="lang-javascript"><span class="token punctuation" >{</span>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
  plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
    <span class="token keyword" >new</span> <span class="token class-name" >ExtractTextPlugin</span><span class="token punctuation" >(</span><span class="token string" >'[name].[contenthash].css'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
    <span class="token comment" spellcheck="true">// Make sure this is after ExtractTextPlugin!</span>
    <span class="token keyword" >new</span> <span class="token class-name" >PurifyCSSPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
      <span class="token comment" spellcheck="true">// Give paths to parse for rules. These should be absolute!</span>
      paths<span class="token punctuation" >:</span> glob<span class="token punctuation" >.</span><span class="token function" >sync</span><span class="token punctuation" >(</span>path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'app/*.html'</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
<span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</code></pre>
<p>In this case it is important the plugin is executed <strong>after</strong> <code>ExtractTextPlugin</code>. That way there is something sensible to process. The plugin also supports more advanced forms of path input. You could pass an <code>entry</code> like object to it to constrain the purifying process per entry instead of relying on the same set of files. This adds some complexity to the implementation, but it&#39;s a good feature to support as it provides more control to the user.</p>
<p>Given failing fast and loud is a good idea when it comes to user-facing interfaces like this, I decided to validate the input carefully. I ended up using JSON Schema for the option definition while validating the input through <a href="https://www.npmjs.com/package/ajv">ajv</a> as this allows me to provide verbose errors related to the input shape and it can capture even typos as it will complain if you try to pass fields that are not supported. Webpack uses a similar solution internally, and it has proven to be a good decision.</p>
<p>Most of the complexity of the plugin has to do with figuring out which data to pass to PurifyCSS. The process has to capture assets from the application hierarchy and perform a lookup against them. Writing the data is the simplest step. To add output, you have to use <code>compilation.assets[&#39;demo.css&#39;] = &#39;demo&#39;;</code> kind of an API.</p>
<p>The source below walks through the main ideas of the plugin in detail. Some of the logic, such as input validation, parsing, and searching, have been pushed behind modules of their own as they have little to do with the main flow of the plugin.</p>
<pre><code class="lang-javascript"><span class="token keyword" >import</span> purify <span class="token keyword" >from</span> <span class="token string" >'purify-css'</span><span class="token punctuation" >;</span>
<span class="token keyword" >import</span> <span class="token punctuation" >{</span> ConcatSource <span class="token punctuation" >}</span> <span class="token keyword" >from</span> <span class="token string" >'webpack-sources'</span><span class="token punctuation" >;</span>
<span class="token keyword" >import</span> <span class="token operator" >*</span> <span class="token keyword" >as</span> parse <span class="token keyword" >from</span> <span class="token string" >'./parse'</span><span class="token punctuation" >;</span>
<span class="token keyword" >import</span> <span class="token operator" >*</span> <span class="token keyword" >as</span> search <span class="token keyword" >from</span> <span class="token string" >'./search'</span><span class="token punctuation" >;</span>
<span class="token keyword" >import</span> validateOptions <span class="token keyword" >from</span> <span class="token string" >'./validate-options'</span><span class="token punctuation" >;</span>
<span class="token keyword" >import</span> schema <span class="token keyword" >from</span> <span class="token string" >'./schema'</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span> <span class="token function" >PurifyPlugin</span><span class="token punctuation" >(</span>options<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >return</span> <span class="token punctuation" >{</span>
    <span class="token function" >apply</span><span class="token punctuation" >(</span>compiler<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      <span class="token keyword" >const</span> validation <span class="token operator" >=</span> <span class="token function" >validateOptions</span><span class="token punctuation" >(</span>
        <span class="token function" >schema</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
          entry<span class="token punctuation" >:</span> compiler<span class="token punctuation" >.</span>options<span class="token punctuation" >.</span>entry
        <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
        options
      <span class="token punctuation" >)</span><span class="token punctuation" >;</span>

      <span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token operator" >!</span>validation<span class="token punctuation" >.</span>isValid<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token keyword" >throw</span> <span class="token keyword" >new</span> <span class="token class-name" >Error</span><span class="token punctuation" >(</span>validation<span class="token punctuation" >.</span>error<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
      <span class="token punctuation" >}</span>

      compiler<span class="token punctuation" >.</span><span class="token function" >plugin</span><span class="token punctuation" >(</span><span class="token string" >'this-compilation'</span><span class="token punctuation" >,</span> <span class="token punctuation" >(</span>compilation<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
        <span class="token keyword" >const</span> entryPaths <span class="token operator" >=</span> parse<span class="token punctuation" >.</span><span class="token function" >entryPaths</span><span class="token punctuation" >(</span>options<span class="token punctuation" >.</span>paths<span class="token punctuation" >)</span><span class="token punctuation" >;</span>

        <span class="token comment" spellcheck="true">// Output debug information through a callback pattern</span>
        <span class="token comment" spellcheck="true">// to avoid unnecessary processing</span>
        <span class="token keyword" >const</span> output <span class="token operator" >=</span> options<span class="token punctuation" >.</span>verbose <span class="token operator" >?</span>
          messageCb <span class="token operator" >=</span><span class="token operator" >></span> console<span class="token punctuation" >.</span><span class="token function" >info</span><span class="token punctuation" >(</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token function" >messageCb</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token punctuation" >:</span>
          <span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span><span class="token punctuation" >}</span><span class="token punctuation" >;</span>

        compilation<span class="token punctuation" >.</span><span class="token function" >plugin</span><span class="token punctuation" >(</span><span class="token string" >'additional-assets'</span><span class="token punctuation" >,</span> <span class="token punctuation" >(</span>cb<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
          <span class="token comment" spellcheck="true">// Go through chunks and purify as configured</span>
          compilation<span class="token punctuation" >.</span>chunks<span class="token punctuation" >.</span><span class="token function" >forEach</span><span class="token punctuation" >(</span>
            <span class="token punctuation" >(</span><span class="token punctuation" >{</span> name<span class="token punctuation" >:</span> chunkName<span class="token punctuation" >,</span> modules <span class="token punctuation" >}</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
              <span class="token keyword" >const</span> assetsToPurify <span class="token operator" >=</span> search<span class="token punctuation" >.</span><span class="token function" >assets</span><span class="token punctuation" >(</span>
                compilation<span class="token punctuation" >.</span>assets<span class="token punctuation" >,</span> options<span class="token punctuation" >.</span>styleExtensions
              <span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >filter</span><span class="token punctuation" >(</span>
                asset <span class="token operator" >=</span><span class="token operator" >></span> asset<span class="token punctuation" >.</span>name<span class="token punctuation" >.</span><span class="token function" >indexOf</span><span class="token punctuation" >(</span>chunkName<span class="token punctuation" >)</span> <span class="token operator" >>=</span> <span class="token number" >0</span>
              <span class="token punctuation" >)</span><span class="token punctuation" >;</span>

              <span class="token function" >output</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >[</span>
                <span class="token string" >'Assets to purify:'</span><span class="token punctuation" >,</span>
                assetsToPurify<span class="token punctuation" >.</span><span class="token function" >map</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span> name <span class="token punctuation" >}</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> name<span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span><span class="token string" >', '</span><span class="token punctuation" >)</span>
              <span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

              assetsToPurify<span class="token punctuation" >.</span><span class="token function" >forEach</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span> name<span class="token punctuation" >,</span> asset <span class="token punctuation" >}</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
                <span class="token keyword" >const</span> filesToSearch <span class="token operator" >=</span> parse<span class="token punctuation" >.</span><span class="token function" >entries</span><span class="token punctuation" >(</span>entryPaths<span class="token punctuation" >,</span> chunkName<span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >concat</span><span class="token punctuation" >(</span>
                  search<span class="token punctuation" >.</span><span class="token function" >files</span><span class="token punctuation" >(</span>
                    modules<span class="token punctuation" >,</span> options<span class="token punctuation" >.</span>moduleExtensions <span class="token operator" >||</span> <span class="token punctuation" >[</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span> file <span class="token operator" >=</span><span class="token operator" >></span> file<span class="token punctuation" >.</span>resource
                  <span class="token punctuation" >)</span>
                <span class="token punctuation" >)</span><span class="token punctuation" >;</span>

                <span class="token function" >output</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >[</span>
                  <span class="token string" >'Files to search for used rules:'</span><span class="token punctuation" >,</span>
                  filesToSearch<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span><span class="token string" >', '</span><span class="token punctuation" >)</span>
                <span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

                <span class="token comment" spellcheck="true">// Compile through Purify and attach to output.</span>
                <span class="token comment" spellcheck="true">// This loses sourcemaps should there be any!</span>
                compilation<span class="token punctuation" >.</span>assets<span class="token punctuation" >[</span>name<span class="token punctuation" >]</span> <span class="token operator" >=</span> <span class="token keyword" >new</span> <span class="token class-name" >ConcatSource</span><span class="token punctuation" >(</span>
                  <span class="token function" >purify</span><span class="token punctuation" >(</span>
                    filesToSearch<span class="token punctuation" >,</span>
                    asset<span class="token punctuation" >.</span><span class="token function" >source</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
                    <span class="token punctuation" >{</span>
                      info<span class="token punctuation" >:</span> options<span class="token punctuation" >.</span>verbose<span class="token punctuation" >,</span>
                      minify<span class="token punctuation" >:</span> options<span class="token punctuation" >.</span>minimize<span class="token punctuation" >,</span>
                      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>options<span class="token punctuation" >.</span>purifyOptions
                    <span class="token punctuation" >}</span>
                  <span class="token punctuation" >)</span>
                <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
              <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token punctuation" >}</span>
          <span class="token punctuation" >)</span><span class="token punctuation" >;</span>

          <span class="token function" >cb</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>Even though this is a simple plugin, it took a lot of effort to achieve a basic implementation. It would be possible to decompose the plugin logic further although it is currently in a manageable shape. There are additional observations that are useful to make based on the implementation:</p>
<ul>
<li>The plugin output has been wrapped in callbacks. This way output related logic is performed only if the output (the <code>verbose</code> flag) has been enabled. It is possible webpack will receive better logging facilities of its own in the future. For now, you can log warnings and errors through <code>compilation.warnings.push(new Error(...))</code> and <code>compilation.errors.push(...)</code> interface.</li>
<li>The plugin has been written in a functional style as much as possible. The individual helper functions have been tested thoroughly and written in a test driven manner.</li>
<li><a href="https://www.npmjs.com/package/webpack-sources">webpack-sources</a> package comes in handy when you have to deal with the source in a format that webpack understands.</li>
</ul>
<h2 class="header"><a class="header-anchor" href="#plugins-can-have-plugins" id="plugins-can-have-plugins"></a><span class="text">Plugins Can Have Plugins</span><a class="header-anchor-select" href="#plugins-can-have-plugins">#</a></h2>
<p>Sometimes it can make sense for a plugin to provide hooks of its own. This way you can write plugins for plugins to extend their functionality. <a href="https://www.npmjs.com/package/html-webpack-plugin">html-webpack-plugin</a> is a good example of that. Example plugins are discussed in detail in the <a href="/webpack/developing/getting-started">Getting Started</a> chapter.</p>
<h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Writing webpack plugins can be challenging at first due to the sheer size of the API webpack provides and it is the most powerful way you can extend webpack, though. When you begin to design a plugin, it is a good idea to spend some time studying existing plugins that are close enough to what you are going to implement as this can generate insight on which hooks you should use and how.</p>
<p>It is a good idea to develop a plugin piece-wise so that you validate one piece of it at a time. The ultimate way to understand webpack plugins in great detail is to delve into webpack source itself as it is a big collection of plugins.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/loader.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/extending/loaders">Extending with Loaders</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/hike.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/conclusion">Conclusion</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-webpack">available through Leanpub</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of Webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Conclusion" href="/webpack/conclusion"><i class="icon-right-open"></i></a><a class="previous-page" title="Extending with Loaders" href="/webpack/extending/loaders"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><a href="https://github.com/survivejs/webpack" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="position:absolute;top:0;fill:#000;right:0;"><path class="octo-banner" d="M0 0l115 115h15l12 27 108 108V0z" fill="#fff"></path><path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin:130px 106px;transform-origin:130px 106px;"></path><path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"></path></svg></a><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/survivejs-webpack-18">SurviveJS - Webpack - v1.8</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-170">SurviveJS - Webpack - v1.7.0</a></li><li><a class="blog-teaser" href="/blog/unexpected-interview">Unexpected - The Extensible BDD Assertion Toolkit - Interview with Sune Simonsen</a></li><li><a class="blog-teaser" href="/blog/ajv-interview">ajv - The Fastest JSON Schema Validator - Interview with Evgeny Poberezkin</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-160">SurviveJS - Webpack - v1.6.0</a></li><li><a class="blog-teaser" href="/blog/isomorphic-webpack-interview">isomorphic-webpack - Universal module consumption using webpack - Interview with Gajus Kuizinas</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-150">SurviveJS - Webpack - v1.5.0</a></li><li><a class="blog-teaser" href="/blog/styletron-interview">Styletron - Universal, high-performance JavaScript styles - Interview with Ryan Tsao</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-142">SurviveJS - Webpack - v1.4.2</a></li><li><a class="blog-teaser" href="/blog/inferno-interview">Inferno - Blazing fast, React-like UI library - Interview with Dominic Gannaway</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
            docsearch({
              apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
              indexName: 'survivejs_webpack',
              inputSelector: '#search',
              debug: false
            });
          </script></div></main></body></html>