<html lang="en"><head><title>SurviveJS - Understanding Chunks</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
Chunks are one of the most fundamental concepts of Webpack. We already touched the topic at the Splitting Bundles chapter. There we set up two separate entries, one for the application code and one for our vendor dependencies.

With some additional setup Webpack was able to output separate bundles …"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/chunks.jpg);"></div><h1 class="post__heading">Understanding Chunks</h1><div class="header-extra"><a href="https://pixabay.com/en/white-chocolate-chocolate-sweet-380702/">caja (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="search-nav--header">Search</h4><input id="search"/><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/webpack-compared">Webpack Compared</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing-with-webpack">Developing with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/splitting-configuration">Splitting the Configuration</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/refreshing-css">Refreshing CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/enabling-sourcemaps">Enabling Sourcemaps</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building-with-webpack">Building with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/minifying-build">Minifying the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/setting-environment-variables">Setting Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/splitting-bundles">Splitting Bundles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/adding-hashes-to-filenames">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/cleaning-build">Cleaning the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/eliminating-unused-css">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/hosting-on-github-pages">Hosting on GitHub Pages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading-assets">Loading Assets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/formats-supported">Formats Supported</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-styles">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-fonts">Loading Fonts</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/advanced-techniques">Advanced Techniques</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Understanding Chunks</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/linting">Linting in Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/authoring-packages">Authoring Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/writing-loaders">Writing Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/configuring-react">Configuring React</a></li></ul><div><div class="buy-container"><a href="/webpack/introduction"><img class="sidebar-cover" src="/assets/img/webpack_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img class="sidebar-cover" src="/assets/img/react_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><a href="http://www.reactindiebundle.com/" target="_blank"><img class="rib" src="/assets/img/rib.jpg" alt="React Indie Bundle" width="728" height="90"/></a><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/webpack-merge-interview">webpack-merge - Taming Webpack Configuration - Interview with Juho Vepsäläinen</a></blockquote><div class="chapter-content"><p>Chunks are one of the most fundamental concepts of Webpack. We already touched the topic at the <em>Splitting Bundles</em> chapter. There we set up two separate entries, one for the application code and one for our vendor dependencies.</p>
<p>With some additional setup Webpack was able to output separate bundles for these. We also did something similar with CSS as we separated it from our code to a bundle of its own in order to improve caching behavior.</p>
<h2 class="header"><a class="header-anchor" href="#chunk-types" id="chunk-types"></a><span class="text">Chunk Types</span><a class="header-anchor-select" href="#chunk-types">#</a></h2>
<p>As <a href="https://webpack.github.io/docs/code-splitting.html#chunk-types">discussed in the documentation</a>, internally Webpack treats chunks in three types:</p>
<ul>
<li><strong>Entry chunks</strong> - Entry chunks contain Webpack runtime and modules it then loads. So far we&#39;ve been dealing with these.</li>
<li><strong>Normal chunks</strong> - Normal chunks <strong>don&#39;t</strong> contain Webpack runtime. Instead, these can be loaded dynamically while the application is running. A suitable wrapper (JSONP for example) is generated for these.</li>
<li><strong>Initial chunks</strong> - Initial chunks are normal chunks that count towards initial loading time of the application. These are generated by the <code>CommonsChunkPlugin</code>. As a user you don&#39;t have to care about these. It&#39;s the split between entry chunks and normal chunks that&#39;s important.</li>
</ul>
<p>Given we&#39;ve covered how to deal with entry chunks already, I won&#39;t delve into that. Instead, I&#39;m going to show you how to deal with normal chunks. They enable one of the most powerful features of Webpack, lazy loading.</p>
<h2 class="header"><a class="header-anchor" href="#lazy-loading-with-webpack" id="lazy-loading-with-webpack"></a><span class="text">Lazy Loading with Webpack</span><a class="header-anchor-select" href="#lazy-loading-with-webpack">#</a></h2>
<p><img src="/webpack/images/dynamic.png" alt="Bundle with a dynamically loaded normal chunk"></p>
<p>What makes Webpack powerful is its capability of splitting up your application into smaller chunks to load. This is far more flexible than standard concatenation. Even though concatenation works, it&#39;s not always a good approach. This is particularly true when the size of your application begins to grow.</p>
<p>Often you don&#39;t need all of the dependencies at once. As we saw earlier, you can split your dependencies and benefit from browser caching behavior. This is a good step, but it&#39;s not enough always. Your bundles can still be somewhat big. <em>Lazy loading</em> allows us to go further.</p>
<h3 class="header"><a class="header-anchor" href="#introduction-to-lazy-loaded-search-with-lunr-" id="introduction-to-lazy-loaded-search-with-lunr-"></a><span class="text">Introduction to Lazy Loaded Search with <em>lunr</em></span><a class="header-anchor-select" href="#introduction-to-lazy-loaded-search-with-lunr-">#</a></h3>
<p>Let&#39;s say we want to implement a rough little search for our application without a proper search back-end. We might want to use something like <a href="http://lunrjs.com/">lunr</a> for generating an index to search against.</p>
<p>The problem is that the index can be quite big depending on the amount of the content. The dumb way to implement this kind of search would be to include the index required to the application bundle itself and then perform search against that.</p>
<p>The good thing is that we don&#39;t actually need the search index straight from the start. We can do something more clever. We can start loading the index when the user selects our search field.</p>
<p>This defers the loading and moves it to a place where it&#39;s more acceptable. Given the initial search might be slower than the subsequent ones we could display a loading indicator. But that&#39;s fine from the user point of view.</p>
<h3 class="header"><a class="header-anchor" href="#implementing-search-with-lazy-loading" id="implementing-search-with-lazy-loading"></a><span class="text">Implementing Search with Lazy Loading</span><a class="header-anchor-select" href="#implementing-search-with-lazy-loading">#</a></h3>
<p>Implementing this idea is straight-forward. We need to capture when the user selects the search element, load the data unless it has been loaded already, and then execute our search logic against it. In React we could end up with something like this:</p>
<p><strong>App.jsx</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >import</span> React <span class="token keyword" >from</span> <span class="token string" >'react'</span><span class="token punctuation" >;</span>

<span class="token keyword" >export</span> <span class="token keyword" >default</span> <span class="token keyword" >class</span> <span class="token class-name" >App</span> <span class="token keyword" >extends</span> <span class="token class-name" >React<span class="token punctuation" >.</span>Component</span> <span class="token punctuation" >{</span>
  <span class="token function" >constructor</span><span class="token punctuation" >(</span>props<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >super</span><span class="token punctuation" >(</span>props<span class="token punctuation" >)</span><span class="token punctuation" >;</span>

    <span class="token keyword" >this</span><span class="token punctuation" >.</span>state <span class="token operator" >=</span> <span class="token punctuation" >{</span>
      index<span class="token punctuation" >:</span> <span class="token keyword" >null</span><span class="token punctuation" >,</span>
      value<span class="token punctuation" >:</span> <span class="token string" >''</span><span class="token punctuation" >,</span>
      lines<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span>
      results<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token punctuation" >]</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >;</span>

    <span class="token keyword" >this</span><span class="token punctuation" >.</span>onChange <span class="token operator" >=</span> <span class="token keyword" >this</span><span class="token punctuation" >.</span>onChange<span class="token punctuation" >.</span><span class="token function" >bind</span><span class="token punctuation" >(</span><span class="token keyword" >this</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>
  <span class="token function" >render</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >const</span> results <span class="token operator" >=</span> <span class="token keyword" >this</span><span class="token punctuation" >.</span>state<span class="token punctuation" >.</span>results<span class="token punctuation" >;</span>

    <span class="token keyword" >return</span> <span class="token punctuation" >(</span>
      <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"app-container"</span><span class="token operator" >></span>
        <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"search-container"</span><span class="token operator" >></span>
          <span class="token operator" >&lt;</span>label<span class="token operator" >></span>Search against README<span class="token punctuation" >:</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>label<span class="token operator" >></span>
          <span class="token operator" >&lt;</span>input
            type<span class="token operator" >=</span><span class="token string" >"text"</span>
            value<span class="token operator" >=</span><span class="token punctuation" >{</span><span class="token keyword" >this</span><span class="token punctuation" >.</span>state<span class="token punctuation" >.</span>value<span class="token punctuation" >}</span>
            onChange<span class="token operator" >=</span><span class="token punctuation" >{</span><span class="token keyword" >this</span><span class="token punctuation" >.</span>onChange<span class="token punctuation" >}</span> <span class="token operator" >/</span><span class="token operator" >></span>
        <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >></span>
        <span class="token operator" >&lt;</span>div className<span class="token operator" >=</span><span class="token string" >"results-container"</span><span class="token operator" >></span>
          <span class="token operator" >&lt;</span>Results results<span class="token operator" >=</span><span class="token punctuation" >{</span>results<span class="token punctuation" >}</span> <span class="token operator" >/</span><span class="token operator" >></span>
        <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >></span>
      <span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >></span>
    <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>
  <span class="token function" >onChange</span><span class="token punctuation" >(</span>e<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >const</span> value <span class="token operator" >=</span> e<span class="token punctuation" >.</span>target<span class="token punctuation" >.</span>value<span class="token punctuation" >;</span>
    <span class="token keyword" >const</span> index <span class="token operator" >=</span> <span class="token keyword" >this</span><span class="token punctuation" >.</span>state<span class="token punctuation" >.</span>index<span class="token punctuation" >;</span>
    <span class="token keyword" >const</span> lines <span class="token operator" >=</span> <span class="token keyword" >this</span><span class="token punctuation" >.</span>state<span class="token punctuation" >.</span>lines<span class="token punctuation" >;</span>

    <span class="token comment" spellcheck="true">// Set captured value to input</span>
    <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token function" >setState</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
      value
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

    <span class="token comment" spellcheck="true">// Search against lines and index if they exist</span>
    <span class="token keyword" >if</span><span class="token punctuation" >(</span>lines <span class="token operator" >&amp;&amp;</span> index<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token function" >setState</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
        results<span class="token punctuation" >:</span> <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token function" >search</span><span class="token punctuation" >(</span>lines<span class="token punctuation" >,</span> index<span class="token punctuation" >,</span> value<span class="token punctuation" >)</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

      <span class="token keyword" >return</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>

    <span class="token comment" spellcheck="true">// If the index doesn't exist, we need to set it up.</span>
    <span class="token comment" spellcheck="true">// Unfortunately we cannot pass the path so we need to</span>
    <span class="token comment" spellcheck="true">// hardcode it (Webpack uses static analysis).</span>
    <span class="token comment" spellcheck="true">//</span>
    <span class="token comment" spellcheck="true">// You could show loading indicator here as loading might</span>
    <span class="token comment" spellcheck="true">// take a while depending on the size of the index.</span>
    <span class="token function" >loadIndex</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >then</span><span class="token punctuation" >(</span>lunr <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
      <span class="token comment" spellcheck="true">// Search against the index now.</span>
      <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token function" >setState</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
        index<span class="token punctuation" >:</span> lunr<span class="token punctuation" >.</span>index<span class="token punctuation" >,</span>
        lines<span class="token punctuation" >:</span> lunr<span class="token punctuation" >.</span>lines<span class="token punctuation" >,</span>
        results<span class="token punctuation" >:</span> <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token function" >search</span><span class="token punctuation" >(</span>lunr<span class="token punctuation" >.</span>lines<span class="token punctuation" >,</span> lunr<span class="token punctuation" >.</span>index<span class="token punctuation" >,</span> value<span class="token punctuation" >)</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token keyword" >catch</span><span class="token punctuation" >(</span>err <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
      <span class="token comment" spellcheck="true">// Something unexpected happened (connection lost</span>
      <span class="token comment" spellcheck="true">// for example).</span>
      console<span class="token punctuation" >.</span><span class="token function" >error</span><span class="token punctuation" >(</span>err<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>
  <span class="token function" >search</span><span class="token punctuation" >(</span>lines<span class="token punctuation" >,</span> index<span class="token punctuation" >,</span> query<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token comment" spellcheck="true">// Search against index and match README lines against the results.</span>
    <span class="token keyword" >return</span> index<span class="token punctuation" >.</span><span class="token function" >search</span><span class="token punctuation" >(</span>query<span class="token punctuation" >.</span><span class="token function" >trim</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >map</span><span class="token punctuation" >(</span>match <span class="token operator" >=</span><span class="token operator" >></span> lines<span class="token punctuation" >[</span>match<span class="token punctuation" >.</span>ref<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token keyword" >const</span> Results <span class="token operator" >=</span> <span class="token punctuation" >(</span><span class="token punctuation" >{</span>results<span class="token punctuation" >}</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
  <span class="token keyword" >if</span><span class="token punctuation" >(</span>results<span class="token punctuation" >.</span>length<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >return</span> <span class="token punctuation" >(</span><span class="token operator" >&lt;</span>ul<span class="token operator" >></span><span class="token punctuation" >{</span>
      results<span class="token punctuation" >.</span><span class="token function" >map</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span>result<span class="token punctuation" >,</span> i<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token operator" >&lt;</span>li key<span class="token operator" >=</span><span class="token punctuation" >{</span>i<span class="token punctuation" >}</span><span class="token operator" >></span><span class="token punctuation" >{</span>result<span class="token punctuation" >}</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>li<span class="token operator" >></span><span class="token punctuation" >)</span>
    <span class="token punctuation" >}</span><span class="token operator" >&lt;</span><span class="token operator" >/</span>ul<span class="token operator" >></span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>

  <span class="token keyword" >return</span> <span class="token operator" >&lt;</span>span<span class="token operator" >></span>No results<span class="token operator" >&lt;</span><span class="token operator" >/</span>span<span class="token operator" >></span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token keyword" >function</span> <span class="token function" >loadIndex</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token comment" spellcheck="true">// Here's the magic. Set up `require.ensure` to tell Webpack</span>
  <span class="token comment" spellcheck="true">// to split here and load our search index dynamically.</span>
  <span class="token comment" spellcheck="true">//</span>
  <span class="token comment" spellcheck="true">// The first parameter defines possible dependencies that</span>
  <span class="token comment" spellcheck="true">// must be loaded first. Given there aren't any, we will</span>
  <span class="token comment" spellcheck="true">// leave it as an empty array.</span>
  <span class="token keyword" >return</span> <span class="token keyword" >new</span> <span class="token class-name" >Promise</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span>resolve<span class="token punctuation" >,</span> reject<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
    <span class="token keyword" >try</span> <span class="token punctuation" >{</span>
      require<span class="token punctuation" >.</span><span class="token function" >ensure</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span> require <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
        <span class="token keyword" >const</span> lunr <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'lunr'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token keyword" >const</span> search <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'../search_index.json'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

        <span class="token function" >resolve</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
          index<span class="token punctuation" >:</span> lunr<span class="token punctuation" >.</span>Index<span class="token punctuation" >.</span><span class="token function" >load</span><span class="token punctuation" >(</span>search<span class="token punctuation" >.</span>index<span class="token punctuation" >)</span><span class="token punctuation" >,</span>
          lines<span class="token punctuation" >:</span> search<span class="token punctuation" >.</span>lines
        <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
    <span class="token keyword" >catch</span><span class="token punctuation" >(</span>err<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      <span class="token function" >reject</span><span class="token punctuation" >(</span>err<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>Even though there&#39;s a lot going on in this example, it&#39;s worth understanding. Webpack detect the <code>require.ensure</code> statically. It is able to generate a separate bundle based on this split point. Given it relies on static analysis, you cannot generalize <code>loadIndex</code> in this case and pass the search index path as a parameter.</p>
<p>The approach is useful with routers too. As the user enters some route, you can load the dependencies the resulting view needs. Alternatively you can start loading dependencies as the user scrolls a page and gets near parts with actual functionality. <code>require.ensure</code> provides a lot of power and allows you to keep your application lean.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i><code>require.ensure</code> respects <code>output.publicPath</code> option.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>Webpack 2 supports <a href="https://github.com/systemjs/systemjs">SystemJS</a> semantics. We can use <code>System.import(&#39;lunr&#39;).then(lunr =&gt; ...).catch(err =&gt; ...)</code> kind of declarations there.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>There&#39;s a <a href="https://github.com/survivejs/lunr-demo">full example</a> showing how it all goes together with lunr, React, and Webpack.</blockquote><h2 class="header"><a class="header-anchor" href="#dynamic-loading-with-webpack" id="dynamic-loading-with-webpack"></a><span class="text">Dynamic Loading with Webpack</span><a class="header-anchor-select" href="#dynamic-loading-with-webpack">#</a></h2>
<p>Beyond <code>require.ensure</code>, there&#39;s another type of <code>require</code> that you should be aware of. It&#39;s <a href="https://webpack.github.io/docs/context.html">require.context</a>. <code>require.context</code> is a type of <code>require</code> which contents aren&#39;t known compile-time.</p>
<p>Let&#39;s say you are writing a static site generator on top of Webpack. You could model your site contents within a directory structure. At the simplest level you could have just a <code>pages/</code> directory which would contain Markdown files.</p>
<p>Each of these files would have a YAML frontmatter for their metadata. The url of each page could be determined based on the filename. This is enough information to map the directory as a site. Code-wise we would end up with a statement like this somewhere:</p>
<pre><code class="lang-javascript"><span class="token comment" spellcheck="true">// Process pages through `yaml-frontmatter-loader` and `json-loader`.</span>
<span class="token comment" spellcheck="true">// The first one extracts the frontmatter and the body and the latter</span>
<span class="token comment" spellcheck="true">// converts it into a JSON structure we can use later. Markdown hasn't</span>
<span class="token comment" spellcheck="true">// been processed yet.</span>
<span class="token keyword" >const</span> req <span class="token operator" >=</span> require<span class="token punctuation" >.</span><span class="token function" >context</span><span class="token punctuation" >(</span>
  <span class="token string" >'json!yaml-frontmatter!./pages'</span><span class="token punctuation" >,</span>
  <span class="token boolean" >true</span><span class="token punctuation" >,</span> <span class="token comment" spellcheck="true">// Load files recursively. Pass false to skip recursion.</span>
  <span class="token regex" >/^\.\/.*\.md$/</span> <span class="token comment" spellcheck="true">// Match files ending with .md.</span>
<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p><code>require.context</code> returns us a function to <code>require</code> against. It also knows its module <code>id</code> and it provides a <code>keys()</code> method for figuring out the contents of the context. To give you a better example, consider the code below:</p>
<pre><code class="lang-javascript">req<span class="token punctuation" >.</span><span class="token function" >keys</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span> <span class="token comment" spellcheck="true">// ['./demo.md', './another-demo.md']</span>

req<span class="token punctuation" >.</span>id<span class="token punctuation" >;</span> <span class="token comment" spellcheck="true">// 42</span>

<span class="token comment" spellcheck="true">// {title: 'Demo', __content: '# Demo page\nDemo content\n\n'}</span>
<span class="token keyword" >const</span> demoPage <span class="token operator" >=</span> <span class="token function" >req</span><span class="token punctuation" >(</span><span class="token string" >'./demo.md'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>This information is enough for generating an entire site. And this is exactly what I&#39;ve done with <a href="https://github.com/antwarjs/antwar">Antwar</a>. You can find a more elaborate example in that static site generator.</p>
<p>The technique can be useful for other purposes, such as testing. When you need a dynamic require, <code>require.context</code> works.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Note that Webpack will also turn statements written in the form <code>require(&#39;./pages/&#39; + pageName + &#39;.md&#39;)</code> into the <code>require.context</code> format!</blockquote><h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Understanding how Webpack&#39;s chunking works helps you to untap a lot of its power. Just applying <code>require.ensure</code> alone can be very effective. It opens a world of possibilities. <code>require.context</code> has more limited possibilities, but it&#39;s a powerful tool especially for tool developers.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/skydiving.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/advanced-techniques">Advanced Techniques</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/lint.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/advanced-techniques/linting">Linting in Webpack</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-webpack">available through Leanpub</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of Webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Linting in Webpack" href="/webpack/advanced-techniques/linting"><i class="icon-right-open"></i></a><a class="previous-page" title="Advanced Techniques" href="/webpack/advanced-techniques"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><a href="https://github.com/survivejs/webpack" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="position:absolute;top:0;fill:#000;right:0;"><path class="octo-banner" d="M0 0l115 115h15l12 27 108 108V0z" fill="#fff"></path><path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin:130px 106px;transform-origin:130px 106px;"></path><path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"></path></svg></a><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/webpack-merge-interview">webpack-merge - Taming Webpack Configuration - Interview with Juho Vepsäläinen</a></li><li><a class="blog-teaser" href="/blog/starratio-interview">StarRatio - Compare JavaScript Projects - Interview with Dmitry Zaets</a></li><li><a class="blog-teaser" href="/blog/redom-interview">RE:DOM - Tiny but Super Fast DOM Library - Interview with Juha Lindstedt</a></li><li><a class="blog-teaser" href="/blog/glamor-interview">Glamor - Inline CSS for React et al - Interview with Sunil Pai</a></li><li><a class="blog-teaser" href="/blog/teaching-javascript-interview">Teaching JavaScript - Interview with Bianca Gandolfo</a></li><li><a class="blog-teaser" href="/blog/react-game-kit-interview">react-game-kit - Make games with React - Interview with Ken Wheeler</a></li><li><a class="blog-teaser" href="/blog/reactotron-interview">Reactotron - A CLI and OS X App for Inspecting - Interview with Steve Kellock</a></li><li><a class="blog-teaser" href="/blog/reactabular-interview">Reactabular - Spectacular tables for React - Interview with Juho Vepsäläinen</a></li><li><a class="blog-teaser" href="/blog/assetgraph-interview">Assetgraph - Optimization Framework for Web Pages and Applications - Interview with Peter Müller</a></li><li><a class="blog-teaser" href="/blog/purescript-interview">PureScript - Strongly Typed Programming Language Compiling to JavaScript - Interview with Phil Freeman</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
            docsearch({
              apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
              indexName: 'survivejs_webpack',
              inputSelector: '#search',
              debug: false
            });
          </script></div></main></body></html>