<html lang="en"><head><title>SurviveJS - Cleaning the Build</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
Our current setup doesn&#x27;t clean the build directory between builds. As this can get annoying if we change our setup, we can use a plugin to clean the directory for us.

Another valid way to resolve the issue would be to handle this outside of Webpack. You could solve it on the system level through …"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/cleaning.jpg);"></div><h1 class="post__heading">Cleaning the Build</h1><div class="header-extra"><a href="https://pixabay.com/en/cleaning-washing-cleanup-the-ilo-268126/">jarmoluk (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/webpack-compared">Webpack Compared</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing-with-webpack">Developing with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/splitting-configuration">Splitting the Configuration</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/refreshing-css">Refreshing CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/enabling-sourcemaps">Enabling Sourcemaps</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building-with-webpack">Building with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/minifying-build">Minifying the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/setting-environment-variables">Setting Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/splitting-bundles">Splitting Bundles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/adding-hashes-to-filenames">Adding Hashes to Filenames</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Cleaning the Build</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/eliminating-unused-css">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/hosting-on-github-pages">Hosting on GitHub Pages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading-assets">Loading Assets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/formats-supported">Formats Supported</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-styles">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-fonts">Loading Fonts</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/advanced-techniques">Advanced Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/understanding-chunks">Understanding Chunks</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/linting">Linting in Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/authoring-packages">Authoring Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/writing-loaders">Writing Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/configuring-react">Configuring React</a></li></ul><div><div class="buy-container"><a href="/webpack/introduction"><img class="sidebar-cover" src="/assets/img/webpack_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img class="sidebar-cover" src="/assets/img/react_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/reactabular-interview">Reactabular - Spectacular tables for React - Interview with Juho Vepsäläinen</a></blockquote><div class="chapter-content"><p>Our current setup doesn&#39;t clean the <code>build</code> directory between builds. As this can get annoying if we change our setup, we can use a plugin to clean the directory for us.</p>
<p>Another valid way to resolve the issue would be to handle this outside of Webpack. You could solve it on the system level through a npm script. In this case you would trigger <code>rm -rf ./build &amp;&amp; webpack</code>. A task runner could work as well.</p>
<h2 class="header"><a class="header-anchor" href="#setting-up-clean-webpack-plugin-" id="setting-up-clean-webpack-plugin-"></a><span class="text">Setting Up <em>clean-webpack-plugin</em></span><a class="header-anchor-select" href="#setting-up-clean-webpack-plugin-">#</a></h2>
<p>Install the <a href="https://www.npmjs.com/package/clean-webpack-plugin">clean-webpack-plugin</a> first:</p>
<pre><code class="lang-bash">npm i clean-webpack-plugin --save-dev
</code></pre>
<p>Next we need to define a little function to wrap the basic idea. We could use the plugin directly, but this feels like something that could be useful across projects so it makes sense to push to our library:</p>
<p><strong>libs/parts.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >const</span> webpack <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'webpack'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<div class="leanpub-insert">
<span class="token keyword" >const</span> CleanWebpackPlugin <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'clean-webpack-plugin'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</div>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<div class="leanpub-insert">
exports<span class="token punctuation" >.</span>clean <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>path<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >return</span> <span class="token punctuation" >{</span>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token keyword" >new</span> <span class="token class-name" >CleanWebpackPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>path<span class="token punctuation" >]</span><span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
        <span class="token comment" spellcheck="true">// Without `root` CleanWebpackPlugin won't point to our</span>
        <span class="token comment" spellcheck="true">// project and will fail to work.</span>
        root<span class="token punctuation" >:</span> process<span class="token punctuation" >.</span><span class="token function" >cwd</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</div>
</code></pre>
<p>We can connect it with our project like this:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token comment" spellcheck="true">// Detect how npm is run and branch based on that</span>
<span class="token keyword" >switch</span><span class="token punctuation" >(</span>process<span class="token punctuation" >.</span>env<span class="token punctuation" >.</span>npm_lifecycle_event<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >case</span> <span class="token string" >'build'</span><span class="token punctuation" >:</span>
    config <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>
      common<span class="token punctuation" >,</span>
      <span class="token punctuation" >{</span>
        devtool<span class="token punctuation" >:</span> <span class="token string" >'source-map'</span><span class="token punctuation" >,</span>
        output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
          path<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >,</span>
          filename<span class="token punctuation" >:</span> <span class="token string" >'[name].[chunkhash].js'</span><span class="token punctuation" >,</span>
          <span class="token comment" spellcheck="true">// This is used for require.ensure. The setup</span>
          <span class="token comment" spellcheck="true">// will work without but this is useful to set.</span>
          chunkFilename<span class="token punctuation" >:</span> <span class="token string" >'[chunkhash].js'</span>
        <span class="token punctuation" >}</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
      parts<span class="token punctuation" >.</span><span class="token function" >clean</span><span class="token punctuation" >(</span>PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >break</span><span class="token punctuation" >;</span>
  <span class="token keyword" >default</span><span class="token punctuation" >:</span>
    <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >validate</span><span class="token punctuation" >(</span>config<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>After this change, our <code>build</code> directory should remain nice and tidy when building. You can verify this by building the project and making sure no old files remained in the output directory.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you want to preserve possible dotfiles within your build directory, you can use <code>path.join(PATHS.build, &#39;*&#39;)</code> instead of <code>PATHS.build</code>.</blockquote><h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Our build is starting to get pretty neat now. There&#39;s one major issue, though. Our CSS has been inlined with JavaScript. This can result in the dreaded <strong>Flash of Unstyled Content</strong> (FOUC). It&#39;s also not ideal caching-wise.</p>
<p>A small change to the CSS would invalidate our <code>app</code> bundle. This doesn&#39;t hurt during development, but it&#39;s not something we want to experience in production. We can resolve this problem by separating our CSS to a file of its own.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/hash.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/building-with-webpack/adding-hashes-to-filenames">Adding Hashes to Filenames</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/taxi.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/building-with-webpack/separating-css">Separating CSS</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-webpack">available through Leanpub</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of Webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Separating CSS" href="/webpack/building-with-webpack/separating-css"><i class="icon-right-open"></i></a><a class="previous-page" title="Adding Hashes to Filenames" href="/webpack/building-with-webpack/adding-hashes-to-filenames"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><a href="https://github.com/survivejs/webpack" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="position:absolute;top:0;fill:#000;right:0;"><path class="octo-banner" d="M0 0l115 115h15l12 27 108 108V0z" fill="#fff"></path><path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin:130px 106px;transform-origin:130px 106px;"></path><path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"></path></svg></a><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/reactabular-interview">Reactabular - Spectacular tables for React - Interview with Juho Vepsäläinen</a></li><li><a class="blog-teaser" href="/blog/assetgraph-interview">Assetgraph - Optimization Framework for Web Pages and Applications - Interview with Peter Müller</a></li><li><a class="blog-teaser" href="/blog/purescript-interview">PureScript - Strongly Typed Programming Language Compiling to JavaScript - Interview with Phil Freeman</a></li><li><a class="blog-teaser" href="/blog/codeceptjs-interview">CodeceptJS - Modern Era Acceptance Testing for Node.js - Interview with Michael Bodnarchuk</a></li><li><a class="blog-teaser" href="/blog/mostly-interview">Mostly Adequate Guide to Functional Programming - Interview with Brian Lonsdorf</a></li><li><a class="blog-teaser" href="/blog/tcomb-interview">tcomb - Type checking and DDD for JavaScript - Interview with Giulio Canti</a></li><li><a class="blog-teaser" href="/blog/redux-saga-interview">redux-saga - Saga Middleware for Redux to Handle Side Effects - Interview with Yassine Elouafi</a></li><li><a class="blog-teaser" href="/blog/snabbdom-interview">Snabbdom - a Virtual DOM Focusing on Simplicity - Interview with Simon Friis Vindum</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-131">SurviveJS - Webpack - v1.3.1</a></li><li><a class="blog-teaser" href="/blog/npms-interview">npms.io - A better and open source search for node modules - Interview with André Cruz</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div></main></body></html>