<html lang="en"><head><title>SurviveJS - Code Splitting</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
Web applications have the tendency to grow big as features are developed. This can be problematic especially for mobile usage. The longer it takes for your application to load, the more frustrating it is to the user. This problem is amplified in a mobile environment where the connections can be sloâ€¦"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/nuts.jpg);"></div><h1 class="post__heading">Code Splitting</h1><div class="header-extra"><a href="https://pixabay.com/en/walnut-italian-cane-shell-hard-1776466/">Arcaion (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="search-nav--header">Search</h4><input id="search"/><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/webpack-compared">Webpack Compared</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/why-webpack">Why Webpack?</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing-with-webpack">Developing with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/configuring-hmr">Configuring Hot Module Replacement</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/linting">Linting JavaScript</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/composing-configuration">Composing Configuration</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/handling-styles">Handling Styles with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/loading">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/eliminating-unused-css">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/linting">Linting CSS</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/understanding-loaders">Understanding Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/loading-images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/loading-fonts">Loading Fonts</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/writing-loaders">Writing Loaders</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building-with-webpack">Building with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/enabling-sourcemaps">Enabling Sourcemaps</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/splitting-bundles">Splitting Bundles</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Code Splitting</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/processing-with-babel">Processing with Babel</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/cleaning-build">Cleaning the Build</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimizing-build">Optimizing the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing-build/minifying">Minifying the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing-build/setting-environment-variables">Setting Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing-build/adding-hashes-to-filenames">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing-build/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/advanced-techniques">Advanced Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/consuming-packages">Consuming Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/authoring-packages">Authoring Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/configuring-react">Configuring React</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/appendices">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/searching-with-react">Searching with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/configuring-hmr-with-react">Configuring Hot Module Replacement with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/writing-eslint-plugins">Writing ESLint Plugins</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/customizing-eslint">Customizing ESLint</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/deploying">Deploying Applications</a></li></ul><div><div class="buy-container"><a href="/webpack/introduction"><img class="sidebar-cover" src="/assets/img/webpack_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img class="sidebar-cover" src="/assets/img/react_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/ajv-interview">ajv - The Fastest JSON Schema Validator - Interview with Evgeny Poberezkin</a></blockquote><div class="chapter-content"><p>Web applications have the tendency to grow big as features are developed. This can be problematic especially for mobile usage. The longer it takes for your application to load, the more frustrating it is to the user. This problem is amplified in a mobile environment where the connections can be slow.</p>
<p>Even though splitting our bundles can help a notch, they are not the only solution and you may still end up having to download a lot of data. Fortunately, it is possible to do better thanks to a technique known as <em>code splitting</em>. It allows us to load code lazily as we need it.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Incidentally, it is possible to implement Google&#39;s <a href="https://developers.google.com/web/fundamentals/performance/prpl-pattern/">PRPL pattern</a> using lazy loading. PRPL (Push, Render, Pre-cache, Lazy-load) has been designed mobile web in mind and can be implemented using webpack.</blockquote><p><img src="/webpack/images/dynamic.png" alt="Bundle with a dynamically-loaded normal chunk"></p>
<h2 class="header"><a class="header-anchor" href="#code-splitting-formats" id="code-splitting-formats"></a><span class="text">Code Splitting Formats</span><a class="header-anchor-select" href="#code-splitting-formats">#</a></h2>
<p>Code splitting can be done in two primary ways in webpack: through a <a href="https://github.com/tc39/proposal-dynamic-import">dynamic import</a> or <code>require.ensure</code> syntax. We&#39;ll be using the former in this demo. The syntax isn&#39;t in the official specification yet so it will require minor tweaks especially at ESLint and Babel too if you are using that.</p>
<h3 class="header"><a class="header-anchor" href="#dynamic-import-" id="dynamic-import-"></a><span class="text">Dynamic <code>import</code></span><a class="header-anchor-select" href="#dynamic-import-">#</a></h3>
<p>Dynamic imports look like this:</p>
<pre><code class="lang-javascript"><span class="token keyword" >import</span><span class="token punctuation" >(</span><span class="token string" >'./module'</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >then</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span>module<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token keyword" >catch</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span>error<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>The <code>Promise</code> based interface allows composition and you could load multiple resources in parallel if wanted. <code>Promise.all</code> would work for that like this:</p>
<pre><code class="lang-javascript">Promise<span class="token punctuation" >.</span><span class="token function" >all</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
  <span class="token keyword" >import</span><span class="token punctuation" >(</span><span class="token string" >'lunr'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  <span class="token keyword" >import</span><span class="token punctuation" >(</span><span class="token string" >'../search_index.json'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >then</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>lunr<span class="token punctuation" >,</span> search<span class="token punctuation" >]</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
  <span class="token keyword" >return</span> <span class="token punctuation" >{</span>
    index<span class="token punctuation" >:</span> lunr<span class="token punctuation" >.</span>Index<span class="token punctuation" >.</span><span class="token function" >load</span><span class="token punctuation" >(</span>search<span class="token punctuation" >.</span>index<span class="token punctuation" >)</span><span class="token punctuation" >,</span>
    lines<span class="token punctuation" >:</span> search<span class="token punctuation" >.</span>lines<span class="token punctuation" >,</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>It is important to note that this will create separate chunks to request. If you wanted only one, you would have to define an intermediate module to <code>import</code>.</p>
<h3 class="header"><a class="header-anchor" href="#-require-ensure-" id="-require-ensure-"></a><span class="text"><code>require.ensure</code></span><a class="header-anchor-select" href="#-require-ensure-">#</a></h3>
<p><a href="https://webpack.js.org/guides/code-splitting-require/#require-ensure-">require.ensure</a> provides an alternate way:</p>
<pre><code class="lang-javascript">require<span class="token punctuation" >.</span><span class="token function" >ensure</span><span class="token punctuation" >(</span>
  <span class="token comment" spellcheck="true">// Modules to load, but not execute yet</span>
  <span class="token punctuation" >[</span><span class="token string" >'./load-earlier'</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
    <span class="token keyword" >const</span> loadEarlier <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./load-earlier'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

    <span class="token comment" spellcheck="true">// Load later on demand and include to the same chunk</span>
    <span class="token keyword" >const</span> module1 <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./module1'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >const</span> module2 <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./module2'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

    <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>As you can see, <code>require.ensure</code> definition is more powerful. The gotcha is that it doesn&#39;t support error handling. Often you can achieve what you want through a dynamic <code>import</code>, but it&#39;s good to know this form exists as well.</p>
<blockquote class="warning"><i class="icon-attention"></i><code>require.ensure</code> relies on <code>Promise</code>s internally. If you use <code>require.ensure</code> with older browsers, remember to shim <code>Promise</code> using a polyfill such as <a href="https://www.npmjs.com/package/es6-promise">es6-promise</a>.</blockquote><h3 class="header"><a class="header-anchor" href="#-require-include-" id="-require-include-"></a><span class="text"><code>require.include</code></span><a class="header-anchor-select" href="#-require-include-">#</a></h3>
<p>The example above could be rewritten using a webpack specific function known as <code>require.include</code>:</p>
<pre><code>require.ensure<span class="token punctuation" >(</span>
  <span class="token punctuation" >[</span><span class="token punctuation" >]</span>,
  <span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
    require.include<span class="token punctuation" >(</span><span class="token string" >'./load-earlier'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

    const loadEarlier <span class="token operator" >=</span> require<span class="token punctuation" >(</span><span class="token string" >'./load-earlier'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

    // Load later on demand and include to the same chunk
    const module1 <span class="token operator" >=</span> require<span class="token punctuation" >(</span><span class="token string" >'./module1'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    const module2 <span class="token operator" >=</span> require<span class="token punctuation" >(</span><span class="token string" >'./module2'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

    <span class="token punctuation" >..</span>.
  <span class="token punctuation" >}</span>
<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre><p>If you had nested <code>require.ensure</code> definitions, you could pull a module to the parent chunk using either syntax.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>The formats respect <code>output.publicPath</code> option. You can also use <code>output.chunkFilename</code> to shape where they output. Example: <code>chunkFilename: &#39;scripts/[name].js&#39;</code>.</blockquote><h2 class="header"><a class="header-anchor" href="#setting-up-code-splitting" id="setting-up-code-splitting"></a><span class="text">Setting Up Code Splitting</span><a class="header-anchor-select" href="#setting-up-code-splitting">#</a></h2>
<p>To demonstrate the idea of code splitting, we should pick up one of the formats above and integrate it to our project. Dynamic <code>import</code> is enough. Before we can implement the webpack side, ESLint needs a slight tweak.</p>
<h3 class="header"><a class="header-anchor" href="#tweaking-eslint" id="tweaking-eslint"></a><span class="text">Tweaking ESLint</span><a class="header-anchor-select" href="#tweaking-eslint">#</a></h3>
<p>Given ESLint supports only standard ES6 out of the box, it requires some tweaking to work with dynamic <code>import</code>. Install <em>babel-eslint</em> parser first:</p>
<pre><code class="lang-bash">npm i babel-eslint -D
</code></pre>
<p>Tweak ESLint configuration as follows:</p>
<p><strong>.eslintrc.js</strong></p>
<pre><code class="lang-javascript">module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  <span class="token string" >"env"</span><span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    <span class="token string" >"browser"</span><span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
    <span class="token string" >"commonjs"</span><span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
    <span class="token string" >"es6"</span><span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
    <span class="token string" >"node"</span><span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token string" >"extends"</span><span class="token punctuation" >:</span> <span class="token string" >"eslint:recommended"</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
  <span class="token string" >"parser"</span><span class="token punctuation" >:</span> <span class="token string" >"babel-eslint"</span><span class="token punctuation" >,</span>
</div>
  <span class="token string" >"parserOptions"</span><span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    <span class="token string" >"sourceType"</span><span class="token punctuation" >:</span> <span class="token string" >"module"</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
    <span class="token string" >"allowImportExportEverywhere"</span><span class="token punctuation" >:</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span>
</div>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>After these changes, ESLint won&#39;t complain if we write <code>import</code> in the middle of our code.</p>
<h3 class="header"><a class="header-anchor" href="#defining-a-split-point-using-a-dynamic-import-" id="defining-a-split-point-using-a-dynamic-import-"></a><span class="text">Defining a Split Point Using a Dynamic <code>import</code></span><a class="header-anchor-select" href="#defining-a-split-point-using-a-dynamic-import-">#</a></h3>
<p>A simple way to illustrate the idea might be to set up a module that contains a string that will replace the text of our demo button. Set up a file as follows:</p>
<p><strong>app/lazy.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >export</span> <span class="token keyword" >default</span> <span class="token string" >'Hello from lazy'</span><span class="token punctuation" >;</span>
</code></pre>
<p>In practice, you could have a lot more code here and additional split points. This is a good place to extend the demonstration.</p>
<p>We also need to point the application to this file so it knows to load it. A simple way to do this is to bind the loading process to click. Whenever the user happens to click the button, we&#39;ll trigger the loading process and replace the button content.</p>
<p><strong>app/component.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >export</span> <span class="token keyword" >default</span> <span class="token keyword" >function</span> <span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >const</span> element <span class="token operator" >=</span> document<span class="token punctuation" >.</span><span class="token function" >createElement</span><span class="token punctuation" >(</span><span class="token string" >'h1'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  element<span class="token punctuation" >.</span>className <span class="token operator" >=</span> <span class="token string" >'pure-button'</span><span class="token punctuation" >;</span>
  element<span class="token punctuation" >.</span>innerHTML <span class="token operator" >=</span> <span class="token string" >'Hello world'</span><span class="token punctuation" >;</span>
<div class="leanpub-insert">
  element<span class="token punctuation" >.</span>onclick <span class="token operator" >=</span> <span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
    <span class="token keyword" >import</span><span class="token punctuation" >(</span><span class="token string" >'./lazy'</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >then</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span>lazy<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
      element<span class="token punctuation" >.</span>textContent <span class="token operator" >=</span> lazy<span class="token punctuation" >.</span><span class="token keyword" >default</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token keyword" >catch</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span>err<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
      console<span class="token punctuation" >.</span><span class="token function" >error</span><span class="token punctuation" >(</span>err<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</div>

  <span class="token keyword" >return</span> element<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>If you open up the application (<code>npm start</code>) and click the button, you should see the new text in the button.</p>
<p><img src="/webpack/images/lazy.png" alt="Lazy loaded button content"></p>
<p>Perhaps the more interesting thing is to see what the build result looks like. If you run <code>npm run build</code>, you should see something like this:</p>
<pre><code class="lang-bash">Hash: 230ee0afd5597af17cb1
Version: webpack 2.2.0
Time: 1901ms
        Asset       Size  Chunks             Chunk Names
         0.js  314 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
       app.js    2.32 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
    vendor.js     141 kB       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
      app.css     2.2 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
     0.js.map  277 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
   app.js.map    1.95 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
  app.css.map   84 bytes       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
vendor.js.map     167 kB       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
   index.html  274 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> ./~/process/browser.js 5.3 kB <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>3<span class="token punctuation" >]</span> ./~/react/lib/ReactElement.js 11.2 kB <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>7<span class="token punctuation" >]</span> ./~/react/react.js 56 bytes <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >..</span>.
</code></pre>
<p>That <em>0.js</em> is our split point. Examining the file reveals that webpack has wrapped the code in a <code>webpackJsonp</code> block and processed the code bit.</p>
<h3 class="header"><a class="header-anchor" href="#defining-a-split-point-using-require-ensure-" id="defining-a-split-point-using-require-ensure-"></a><span class="text">Defining a Split Point Using <code>require.ensure</code></span><a class="header-anchor-select" href="#defining-a-split-point-using-require-ensure-">#</a></h3>
<p>It is possible to achieve the same with <code>require.ensure</code>. Consider the full example below:</p>
<pre><code class="lang-javascript"><span class="token keyword" >export</span> <span class="token keyword" >default</span> <span class="token keyword" >function</span> <span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >const</span> element <span class="token operator" >=</span> document<span class="token punctuation" >.</span><span class="token function" >createElement</span><span class="token punctuation" >(</span><span class="token string" >'h1'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  element<span class="token punctuation" >.</span>className <span class="token operator" >=</span> <span class="token string" >'pure-button'</span><span class="token punctuation" >;</span>
  element<span class="token punctuation" >.</span>innerHTML <span class="token operator" >=</span> <span class="token string" >'Hello world'</span><span class="token punctuation" >;</span>
  element<span class="token punctuation" >.</span>onclick <span class="token operator" >=</span> <span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
    require<span class="token punctuation" >.</span><span class="token function" >ensure</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span> <span class="token punctuation" >(</span>require<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
      element<span class="token punctuation" >.</span>textContent <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./lazy'</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token keyword" >default</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >;</span>

  <span class="token keyword" >return</span> element<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<blockquote class="tip"><i class="icon-attention-circled"></i><a href="https://www.npmjs.com/package/bundle-loader">bundle-loader</a> gives similar results, but through a loader interface.</blockquote><h2 class="header"><a class="header-anchor" href="#dynamic-loading-with-require-context-" id="dynamic-loading-with-require-context-"></a><span class="text">Dynamic Loading with <code>require.context</code></span><a class="header-anchor-select" href="#dynamic-loading-with-require-context-">#</a></h2>
<p>Beyond the variants above, there&#39;s another type of <code>require</code> that you should be aware of. <a href="https://webpack.js.org/configuration/entry-context/#context">require.context</a> is a general form of the above.</p>
<p>Let&#39;s say you are writing a static site generator on top of webpack. You could model your site contents within a directory structure. At the simplest level, you could have just <code>./pages/</code> directory which would contain Markdown files.</p>
<p>Each of these files would have a YAML frontmatter for their metadata. The url of each page could be determined based on the filename. This is enough information to map the directory as a site. Code-wise we would end up with a statement like this somewhere:</p>
<pre><code class="lang-javascript"><span class="token comment" spellcheck="true">// Process pages through `yaml-frontmatter-loader` and `json-loader`.</span>
<span class="token comment" spellcheck="true">// The first one extracts the frontmatter and the body and the latter</span>
<span class="token comment" spellcheck="true">// converts it into a JSON structure we can use later. Markdown hasn't</span>
<span class="token comment" spellcheck="true">// been processed yet.</span>
<span class="token keyword" >const</span> req <span class="token operator" >=</span> require<span class="token punctuation" >.</span><span class="token function" >context</span><span class="token punctuation" >(</span>
  <span class="token string" >'json-loader!yaml-frontmatter-loader!./pages'</span><span class="token punctuation" >,</span>
  <span class="token boolean" >true</span><span class="token punctuation" >,</span> <span class="token comment" spellcheck="true">// Load files recursively. Pass false to skip recursion.</span>
  <span class="token regex" >/^\.\/.*\.md$/</span> <span class="token comment" spellcheck="true">// Match files ending with .md.</span>
<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p><code>require.context</code> returns us a function to <code>require</code> against. It also knows its module <code>id</code> and it provides a <code>keys()</code> method for figuring out the contents of the context. To give you a better example, consider the code below:</p>
<pre><code class="lang-javascript">req<span class="token punctuation" >.</span><span class="token function" >keys</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span> <span class="token comment" spellcheck="true">// ['./demo.md', './another-demo.md']</span>

req<span class="token punctuation" >.</span>id<span class="token punctuation" >;</span> <span class="token comment" spellcheck="true">// 42</span>

<span class="token comment" spellcheck="true">// {title: 'Demo', __content: '# Demo page\nDemo content\n\n'}</span>
<span class="token keyword" >const</span> demoPage <span class="token operator" >=</span> <span class="token function" >req</span><span class="token punctuation" >(</span><span class="token string" >'./demo.md'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>This information is enough for generating an entire site. And this is exactly what I&#39;ve done with <a href="https://github.com/antwarjs/antwar">Antwar</a>. You can find a more elaborate example in that static site generator.</p>
<p>The technique can be useful for other purposes, such as testing or adding files for webpack to watch. In that case, you would set up a <code>require.context</code> within a file which you then point to through a webpack <code>entry</code>.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Note that webpack will also turn statements written in the form <code>require(&#39;./pages/&#39; + pageName + &#39;.md&#39;)</code> into the <code>require.context</code> format!</blockquote><h2 class="header"><a class="header-anchor" href="#combining-multiple-require-context-s" id="combining-multiple-require-context-s"></a><span class="text">Combining Multiple <code>require.context</code>s</span><a class="header-anchor-select" href="#combining-multiple-require-context-s">#</a></h2>
<p>Sometimes you might need to combine multiple separate <code>require.context</code>s into one. This can be done by wrapping them behind a similar API like this:</p>
<pre><code class="lang-javascript"><span class="token keyword" >const</span> <span class="token punctuation" >{</span> concat<span class="token punctuation" >,</span> uniq <span class="token punctuation" >}</span> <span class="token keyword" >from</span> <span class="token string" >'lodash'</span><span class="token punctuation" >;</span>

<span class="token keyword" >function</span> <span class="token function" >combineContexts</span><span class="token punctuation" >(</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>contexts<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >function</span> <span class="token function" >webpackContext</span><span class="token punctuation" >(</span>req<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token comment" spellcheck="true">// Find the first match and execute</span>
    <span class="token keyword" >const</span> matches <span class="token operator" >=</span> contexts<span class="token punctuation" >.</span><span class="token function" >map</span><span class="token punctuation" >(</span>
      context <span class="token operator" >=</span><span class="token operator" >></span> context<span class="token punctuation" >.</span><span class="token function" >keys</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >indexOf</span><span class="token punctuation" >(</span>req<span class="token punctuation" >)</span> <span class="token operator" >>=</span> <span class="token number" >0</span> <span class="token operator" >&amp;&amp;</span> context
    <span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >filter</span><span class="token punctuation" >(</span>a <span class="token operator" >=</span><span class="token operator" >></span> a<span class="token punctuation" >)</span><span class="token punctuation" >;</span>

    <span class="token keyword" >return</span> matches<span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >]</span> <span class="token operator" >&amp;&amp;</span> matches<span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >]</span><span class="token punctuation" >(</span>req<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>
  webpackContext<span class="token punctuation" >.</span>keys <span class="token operator" >=</span> <span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token function" >uniq</span><span class="token punctuation" >(</span>
    concat<span class="token punctuation" >.</span><span class="token function" >apply</span><span class="token punctuation" >(</span>
      <span class="token keyword" >null</span><span class="token punctuation" >,</span>
      contexts<span class="token punctuation" >.</span><span class="token function" >map</span><span class="token punctuation" >(</span>
        context <span class="token operator" >=</span><span class="token operator" >></span> context<span class="token punctuation" >.</span><span class="token function" >keys</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span>
      <span class="token punctuation" >)</span>
    <span class="token punctuation" >)</span>
  <span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword" >return</span> webpackContext<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<h2 class="header"><a class="header-anchor" href="#dynamic-paths-with-a-dynamic-import-" id="dynamic-paths-with-a-dynamic-import-"></a><span class="text">Dynamic Paths with a Dynamic <code>import</code></span><a class="header-anchor-select" href="#dynamic-paths-with-a-dynamic-import-">#</a></h2>
<p>The same idea works with dynamic <code>import</code>. Instead of passing an absolute path, you can pass a partial one. Webpack will set up a context internally. Here&#39;s a brief example:</p>
<pre><code class="lang-javascript"><span class="token comment" spellcheck="true">// Set up a target or derive this somehow</span>
<span class="token keyword" >const</span> target <span class="token operator" >=</span> <span class="token string" >'demo.json'</span><span class="token punctuation" >;</span>

<span class="token comment" spellcheck="true">// Elsewhere in code</span>
<span class="token keyword" >import</span><span class="token punctuation" >(</span><span class="token template-string" ><span class="token string" >`indexes/</span><span class="token interpolation" ><span class="token interpolation-punctuation punctuation" >${</span>target<span class="token interpolation-punctuation punctuation" >}</span></span><span class="token string" >`</span></span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >then</span><span class="token punctuation" >(</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token keyword" >catch</span><span class="token punctuation" >(</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<h2 class="header"><a class="header-anchor" href="#dealing-with-dynamic-paths" id="dealing-with-dynamic-paths"></a><span class="text">Dealing with Dynamic Paths</span><a class="header-anchor-select" href="#dealing-with-dynamic-paths">#</a></h2>
<p>Given the approaches discussed here rely on static analysis and webpack has to find the files in question, it doesn&#39;t work for every possible case. If the files you need are on another server or have to be accessed through a specific end-point, then webpack isn&#39;t enough.</p>
<p>Consider using browser-side loaders like <a href="https://github.com/ded/script.js/">$script.js</a> or <a href="https://github.com/walmartlabs/little-loader">little-loader</a> on top of webpack in this case.</p>
<h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Code splitting is one of those features that allows you to push your application a notch further. You can load code when you need it. This gives faster initial load times and helps to improve user experience especially in a mobile context where bandwidth is limited.</p>
<p>It comes with some extra work as you must figure out what&#39;s possible to split. Often, you find good split points within a router. Or you may notice that specific functionality is required only when specific feature is used. Charting is a good example of this.</p>
<p>Just applying <code>import</code> or <code>require.ensure</code> alone can be very effective. <code>require.context</code> has more limited possibilities, but it&#39;s a powerful tool especially for tool developers.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>There&#39;s a more complete example of how to use the code splitting technique in the <em>Searching with React</em> appendix. You will see how to set up a static site index that&#39;s loaded when the user searches information.</blockquote></div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/bundle.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/building-with-webpack/splitting-bundles">Splitting Bundles</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/babel.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/building-with-webpack/processing-with-babel">Processing with Babel</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-webpack">available through Leanpub</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of Webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Processing with Babel" href="/webpack/building-with-webpack/processing-with-babel"><i class="icon-right-open"></i></a><a class="previous-page" title="Splitting Bundles" href="/webpack/building-with-webpack/splitting-bundles"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><a href="https://github.com/survivejs/webpack" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="position:absolute;top:0;fill:#000;right:0;"><path class="octo-banner" d="M0 0l115 115h15l12 27 108 108V0z" fill="#fff"></path><path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin:130px 106px;transform-origin:130px 106px;"></path><path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"></path></svg></a><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/ajv-interview">ajv - The Fastest JSON Schema Validator - Interview with Evgeny Poberezkin</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-160">SurviveJS - Webpack - v1.6.0</a></li><li><a class="blog-teaser" href="/blog/isomorphic-webpack-interview">isomorphic-webpack - Universal module consumption using webpack - Interview with Gajus Kuizinas</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-150">SurviveJS - Webpack - v1.5.0</a></li><li><a class="blog-teaser" href="/blog/styletron-interview">Styletron - Universal, high-performance JavaScript styles - Interview with Ryan Tsao</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-142">SurviveJS - Webpack - v1.4.2</a></li><li><a class="blog-teaser" href="/blog/inferno-interview">Inferno - Blazing fast, React-like UI library - Interview with Dominic Gannaway</a></li><li><a class="blog-teaser" href="/blog/svelte-interview">Svelte - The magical disappearing UI framework - Interview with Rich Harris</a></li><li><a class="blog-teaser" href="/blog/webpack-merge-interview">webpack-merge - Taming Webpack Configuration - Interview with Juho VepsÃ¤lÃ¤inen</a></li><li><a class="blog-teaser" href="/blog/starratio-interview">StarRatio - Compare JavaScript Projects - Interview with Dmitry Zaets</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
            docsearch({
              apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
              indexName: 'survivejs_webpack',
              inputSelector: '#search',
              debug: false
            });
          </script></div></main></body></html>