<html lang="en"><head><title>SurviveJS - Splitting Bundles</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
Currently the production version of our application is a single JavaScript file. This isn&#x27;t ideal. If we change the application, the client has to download vendor dependencies as well. It would be better to download only the changed portion. If the vendor dependencies change, then the client shouldâ€¦"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/bundle.jpg);"></div><h1 class="post__heading">Splitting Bundles</h1><div class="header-extra"><a href="https://pixabay.com/en/books-student-study-education-1012088/">stevepb (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="search-nav--header">Search</h4><input id="search"/><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/webpack-compared">Webpack Compared</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing-with-webpack">Developing with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/splitting-configuration">Splitting the Configuration</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/refreshing-css">Refreshing CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/enabling-sourcemaps">Enabling Sourcemaps</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building-with-webpack">Building with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/minifying-build">Minifying the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/setting-environment-variables">Setting Environment Variables</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Splitting Bundles</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/adding-hashes-to-filenames">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/cleaning-build">Cleaning the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/eliminating-unused-css">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/hosting-on-github-pages">Hosting on GitHub Pages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading-assets">Loading Assets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/formats-supported">Formats Supported</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-styles">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-fonts">Loading Fonts</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/advanced-techniques">Advanced Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/understanding-chunks">Understanding Chunks</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/linting">Linting in Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/authoring-packages">Authoring Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/writing-loaders">Writing Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/configuring-react">Configuring React</a></li></ul><div><div class="buy-container"><a href="/webpack/introduction"><img class="sidebar-cover" src="/assets/img/webpack_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img class="sidebar-cover" src="/assets/img/react_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/styletron-interview">Styletron - Universal, high-performance JavaScript styles - Interview with Ryan Tsao</a></blockquote><div class="chapter-content"><p>Currently the production version of our application is a single JavaScript file. This isn&#39;t ideal. If we change the application, the client has to download vendor dependencies as well. It would be better to download only the changed portion. If the vendor dependencies change, then the client should fetch only the vendor dependencies. The same goes for actual application code. This technique is known as <strong>bundle splitting</strong>.</p>
<h2 class="header"><a class="header-anchor" href="#the-idea-of-bundle-splitting" id="the-idea-of-bundle-splitting"></a><span class="text">The Idea of Bundle Splitting</span><a class="header-anchor-select" href="#the-idea-of-bundle-splitting">#</a></h2>
<p>Using bundle splitting, we can push the vendor dependencies to a bundle of its own and benefit from client level caching. We can do this in a such way that the whole size of the application remains the same. Given there are more requests to perform, there&#39;s a slight overhead. But the benefit of caching makes up for this cost.</p>
<p>To give you a simple example, instead of having <em>app.js</em> (100 kB), we could end up with <em>app.js</em> (10 kB) and <em>vendor.js</em> (90 kB). Now changes made to the application are cheap for the clients that have already used the application earlier.</p>
<p>Caching comes with its own problems. One of those is cache invalidation. We&#39;ll discuss a potential approach related to that in the next chapter. But before that, let&#39;s split some bundles.</p>
<p>Bundle splitting isn&#39;t the only way out. In the <em>Understanding Chunks</em> chapter we will discuss a technique known as <strong>code splitting</strong> that exists within bundle splitting and allows you to go more granular. Effectively it allows you to load code on demand based on prerequisites related to the user interface.</p>
<h2 class="header"><a class="header-anchor" href="#setting-up-a-vendor-bundle" id="setting-up-a-vendor-bundle"></a><span class="text">Setting Up a <code>vendor</code> Bundle</span><a class="header-anchor-select" href="#setting-up-a-vendor-bundle">#</a></h2>
<p>So far our project has only a single entry named as <code>app</code>. As you might remember, our configuration tells webpack to traverse dependencies starting from the <code>app</code> entry directory and then to output the resulting bundle below our <code>build</code> directory using the entry name and <code>.js</code> extension.</p>
<p>To improve the situation, we can define a <code>vendor</code> entry containing React. This is done by matching the dependency name. It is possible to generate this information automatically as discussed at the end of this chapter, but I&#39;ll go with a static array here to illustrate the basic idea. Change the code like this:</p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token keyword" >const</span> common <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
<div class="leanpub-delete">
    app<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app
</div>
<div class="leanpub-insert">
    app<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app<span class="token punctuation" >,</span>
    vendor<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'react'</span><span class="token punctuation" >]</span>
</div>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    path<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >,</span>
    filename<span class="token punctuation" >:</span> <span class="token string" >'[name].js'</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
    <span class="token keyword" >new</span> <span class="token class-name" >HtmlWebpackPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
      title<span class="token punctuation" >:</span> <span class="token string" >'Webpack demo'</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
  <span class="token punctuation" >]</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
</code></pre>
<p>We have two separate entries, or <strong>entry chunks</strong>, now. The <em>Understanding Chunks</em> chapter digs into other available chunk types. Now we have a mapping between entries and the output configuration. <code>[name].js</code> will kick in based on the entry name and if you try to generate a build now (<code>npm run build</code>), you should see something like this:</p>
<pre><code class="lang-bash">Hash: 429e76650de02eccd6f9
Version: webpack 2.2.0-rc.1
Time: 1455ms
     Asset       Size  Chunks           Chunk Names
    app.js    24.1 kB  0<span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
 vendor.js    20.1 kB  1<span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
index.html  236 bytes  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>27<span class="token punctuation" >]</span> ./app/component.js 136 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>28<span class="token punctuation" >]</span> ./app/main.css 904 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>29<span class="token punctuation" >]</span> ./~/css-loader<span class="token operator" >!</span>./app/main.css 190 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>32<span class="token punctuation" >]</span> ./app/index.js 124 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>33<span class="token punctuation" >]</span> multi vendor 28 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
    + 29 hidden modules
Child html-webpack-plugin <span class="token keyword" >for</span> <span class="token string" >"index.html"</span><span class="token keyword" >:</span>
        + 4 hidden modules
</code></pre>
<p><em>app.js</em> and <em>vendor.js</em> have separate chunk ids right now given they are entry chunks of their own. The output size is a little off, though. <em>app.js</em> should be significantly smaller to attain our goal with this build.</p>
<p>If you examine the resulting bundle, you can see that it contains React given that&#39;s how the default definition works. Webpack pulls the related dependencies to a bundle by default as illustrated by the image below:</p>
<p><img src="/webpack/images/bundle_01.png" alt="Separate app and vendor bundles"></p>
<p>A webpack plugin known as <code>CommonsChunkPlugin</code> allows us alter this default behavior so that we can get the bundles we might expect.</p>
<blockquote class="warning"><i class="icon-attention"></i>This step can fail on Windows due to letter casing. Instead of <code>c:\</code> you may need to force your terminal to read <code>C:\</code>. There&#39;s more information in the <a href="https://github.com/webpack/webpack/issues/2362">related webpack issue</a>.</blockquote><h2 class="header"><a class="header-anchor" href="#setting-up-commonschunkplugin-" id="setting-up-commonschunkplugin-"></a><span class="text">Setting Up <code>CommonsChunkPlugin</code></span><a class="header-anchor-select" href="#setting-up-commonschunkplugin-">#</a></h2>
<p><a href="https://webpack.js.org/guides/code-splitting-libraries/#commonschunkplugin">CommonsChunkPlugin</a> is a powerful and complex plugin. The use case we are covering here is a basic yet useful one. As before, we can define a function that wraps the basic idea.</p>
<p>To make our life easier in the future, we can make it extract a file known as a <strong>manifest</strong>. It contains the webpack runtime that starts the whole application and contains the dependency information needed by it. This avoids a serious invalidation problem. Even though it&#39;s yet another file for the browser to load, it allows us to implement reliable caching in the next chapter.</p>
<p>If we don&#39;t extract a manifest, webpack will generate the runtime to the vendor bundle. In case we modify the application code, the application bundle hash will change. This is problematic as it will invalidate both bundles since the runtime needs to change too. This is why you should keep the manifest separate from the main bundles as doing this avoids the problem.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you want to see this behavior in practice, try tweaking the implementation so that it <strong>doesn&#39;t</strong> generate the manifest after the next chapter. Change application code after that and see what happens to the generated code.</blockquote><p>The following code combines the <code>entry</code> idea above with a basic <code>CommonsChunkPlugin</code> setup:</p>
<p><strong>webpack.parts.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<div class="leanpub-insert">
exports<span class="token punctuation" >.</span>extractBundle <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>options<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >const</span> entry <span class="token operator" >=</span> <span class="token punctuation" >{</span><span class="token punctuation" >}</span><span class="token punctuation" >;</span>
  entry<span class="token punctuation" >[</span>options<span class="token punctuation" >.</span>name<span class="token punctuation" >]</span> <span class="token operator" >=</span> options<span class="token punctuation" >.</span>entries<span class="token punctuation" >;</span>

  <span class="token keyword" >return</span> <span class="token punctuation" >{</span>
    <span class="token comment" spellcheck="true">// Define an entry point needed for splitting.</span>
    entry<span class="token punctuation" >:</span> entry<span class="token punctuation" >,</span>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token comment" spellcheck="true">// Extract bundle and manifest files. Manifest is</span>
      <span class="token comment" spellcheck="true">// needed for reliable caching.</span>
      <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>optimize<span class="token punctuation" >.</span>CommonsChunkPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
        names<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>options<span class="token punctuation" >.</span>name<span class="token punctuation" >,</span> <span class="token string" >'manifest'</span><span class="token punctuation" >]</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</div>
</code></pre>
<p>Given the function handles the entry for us, we can drop our <code>vendor</code> related configuration and use the function instead:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token keyword" >const</span> common <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
<div class="leanpub-delete">
    app<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app<span class="token punctuation" >,</span>
    vendor<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'react'</span><span class="token punctuation" >]</span>
</div>
<div class="leanpub-insert">
    app<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app
</div>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    path<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >,</span>
    filename<span class="token punctuation" >:</span> <span class="token string" >'[name].js'</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
    <span class="token keyword" >new</span> <span class="token class-name" >HtmlWebpackPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
      title<span class="token punctuation" >:</span> <span class="token string" >'Webpack demo'</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
  <span class="token punctuation" >]</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>env<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>env <span class="token operator" >===</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >return</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>
      common<span class="token punctuation" >,</span>
      <span class="token punctuation" >{</span>
        devtool<span class="token punctuation" >:</span> <span class="token string" >'source-map'</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >setFreeVariable</span><span class="token punctuation" >(</span>
        <span class="token string" >'process.env.NODE_ENV'</span><span class="token punctuation" >,</span>
        <span class="token string" >'production'</span>
      <span class="token punctuation" >)</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
      parts<span class="token punctuation" >.</span><span class="token function" >extractBundle</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
        name<span class="token punctuation" >:</span> <span class="token string" >'vendor'</span><span class="token punctuation" >,</span>
        entries<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'react'</span><span class="token punctuation" >]</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
      parts<span class="token punctuation" >.</span><span class="token function" >minify</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >setupCSS</span><span class="token punctuation" >(</span>PATHS<span class="token punctuation" >.</span>app<span class="token punctuation" >)</span>
    <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>

  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>If you execute the build now using <code>npm run build</code>, you should see something along this:</p>
<pre><code class="lang-bash">Hash: db8515bb8c604c66b5b7
Version: webpack 2.2.0-rc.1
Time: 1225ms
      Asset       Size  Chunks           Chunk Names
  vendor.js    19.7 kB  0, 2<span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
     app.js    4.06 kB  1, 2<span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
manifest.js    1.37 kB  2<span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  manifest
 index.html  294 bytes  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>15<span class="token punctuation" >]</span> ./app/component.js 136 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>16<span class="token punctuation" >]</span> ./app/main.css 904 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>17<span class="token punctuation" >]</span> ./~/css-loader<span class="token operator" >!</span>./app/main.css 190 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>32<span class="token punctuation" >]</span> ./app/index.js 124 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>33<span class="token punctuation" >]</span> multi vendor 28 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
    + 29 hidden modules
Child html-webpack-plugin <span class="token keyword" >for</span> <span class="token string" >"index.html"</span><span class="token keyword" >:</span>
        + 4 hidden modules
</code></pre>
<p>Now our bundles look just the way we want. The image below illustrates the current situation:</p>
<p><img src="/webpack/images/bundle_02.png" alt="App and vendor bundles after applying `CommonsChunkPlugin`"></p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Beyond this, it is possible to define chunks that are loaded dynamically. This can be achieved through <a href="https://webpack.js.org/guides/code-splitting-require/">require.ensure or import</a>. We&#39;ll cover it in the <em>Understanding Chunks</em> chapter.</blockquote><h2 class="header"><a class="header-anchor" href="#loading-dependencies-to-a-vendor-bundle-automatically" id="loading-dependencies-to-a-vendor-bundle-automatically"></a><span class="text">Loading <code>dependencies</code> to a <code>vendor</code> Bundle Automatically</span><a class="header-anchor-select" href="#loading-dependencies-to-a-vendor-bundle-automatically">#</a></h2>
<p>If you maintain strict separation between <code>dependencies</code> and <code>devDependencies</code>, you can make webpack to pick up your <code>vendor</code> dependencies automatically based on this information. You avoid having to manage those manually then.</p>
<p>Instead of having <code>[&#39;react&#39;]</code>, we could have <code>Object.keys(require(&#39;./package.json&#39;).dependencies)</code>. That can be filtered and adjusted further if needed depending on how dynamic solution you want.</p>
<p>CommonsChunkPlugin<code>provides a</code>minChunks` parameter. In addition to a number and certain other values, it accepts a function. This makes it possible to deduce which modules are external without having to perform a lookup against <em>package.json</em>. To adapt Rafael De Leon&#39;s solution from <a href="http://stackoverflow.com/a/38733864/228885">Stack Overflow</a>, you could end up with code like this:</p>
<pre><code class="lang-javascript"><span class="token keyword" >new</span> <span class="token class-name" >CommonsChunkPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
  name<span class="token punctuation" >:</span> <span class="token string" >'vendor'</span><span class="token punctuation" >,</span>
  minChunks<span class="token punctuation" >:</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>module<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >const</span> userRequest <span class="token operator" >=</span> module<span class="token punctuation" >.</span>userRequest<span class="token punctuation" >;</span>

    <span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token keyword" >typeof</span> userRequest <span class="token operator" >!==</span> <span class="token string" >'string'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      <span class="token keyword" >return</span> <span class="token boolean" >false</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>

    <span class="token comment" spellcheck="true">// You can perform other similar checks here too.</span>
    <span class="token comment" spellcheck="true">// Now we check just node_modules.</span>
    <span class="token keyword" >return</span> userRequest<span class="token punctuation" >.</span><span class="token function" >indexOf</span><span class="token punctuation" >(</span><span class="token string" >'node_modules'</span><span class="token punctuation" >)</span> <span class="token operator" >>=</span> <span class="token number" >0</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</code></pre>
<p>It would be easy to extend <code>extractBundle</code> so that you have more control over <code>minChunks</code> behavior. Then you could plug in <code>isExternal</code> check for <code>minChunks</code>. The advantage of this approach is that it will use <strong>only</strong> dependencies you refer to in your application.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i><code>webpack.ProgressPlugin</code> or <a href="https://www.npmjs.com/package/nyan-progress-webpack-plugin">nyan-progress-webpack-plugin</a> can be used to get tidier output during the build process. Take care with Continuous Integration (CI) systems like Travis, though, as they might clobber the output.</blockquote><h2 class="header"><a class="header-anchor" href="#tidying-up-development-console" id="tidying-up-development-console"></a><span class="text">Tidying Up Development Console</span><a class="header-anchor-select" href="#tidying-up-development-console">#</a></h2>
<p>You might notice that if you run the development server now, it prints out <code>[WDS] Hot Module Replacement enabled.</code> twice at the browser console. This happens because <em>webpack-dev-server</em> hooks up HMR per entry. One way to solve this is to perform <code>extractBundle</code> for the development configuration as well.</p>
<p>This can be achieved by pushing the current <code>extractBundle</code> code to <code>common</code> and merging it there to the rest so that you get <code>const common = merge({ ... }, extractBundle(...))</code>. If you do this, remember to remove <code>extractBundle</code> from the production specific branch of your configuration.</p>
<h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>The situation is far better now. Note how small <code>app</code> bundle compared to the <code>vendor</code> bundle. In order to really benefit from this split, we should set up caching. This can be achieved by adding cache busting hashes to the filenames.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/firewood.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/building-with-webpack/setting-environment-variables">Setting Environment Variables</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/hash.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/building-with-webpack/adding-hashes-to-filenames">Adding Hashes to Filenames</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-webpack">available through Leanpub</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of Webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Adding Hashes to Filenames" href="/webpack/building-with-webpack/adding-hashes-to-filenames"><i class="icon-right-open"></i></a><a class="previous-page" title="Setting Environment Variables" href="/webpack/building-with-webpack/setting-environment-variables"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><a href="https://github.com/survivejs/webpack" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="position:absolute;top:0;fill:#000;right:0;"><path class="octo-banner" d="M0 0l115 115h15l12 27 108 108V0z" fill="#fff"></path><path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin:130px 106px;transform-origin:130px 106px;"></path><path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"></path></svg></a><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/styletron-interview">Styletron - Universal, high-performance JavaScript styles - Interview with Ryan Tsao</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-142">SurviveJS - Webpack - v1.4.2</a></li><li><a class="blog-teaser" href="/blog/inferno-interview">Inferno - Blazing fast, React-like UI library - Interview with Dominic Gannaway</a></li><li><a class="blog-teaser" href="/blog/svelte-interview">Svelte - The magical disappearing UI framework - Interview with Rich Harris</a></li><li><a class="blog-teaser" href="/blog/webpack-merge-interview">webpack-merge - Taming Webpack Configuration - Interview with Juho VepsÃ¤lÃ¤inen</a></li><li><a class="blog-teaser" href="/blog/starratio-interview">StarRatio - Compare JavaScript Projects - Interview with Dmitry Zaets</a></li><li><a class="blog-teaser" href="/blog/redom-interview">RE:DOM - Tiny but Super Fast DOM Library - Interview with Juha Lindstedt</a></li><li><a class="blog-teaser" href="/blog/glamor-interview">Glamor - Inline CSS for React et al - Interview with Sunil Pai</a></li><li><a class="blog-teaser" href="/blog/teaching-javascript-interview">Teaching JavaScript - Interview with Bianca Gandolfo</a></li><li><a class="blog-teaser" href="/blog/react-game-kit-interview">react-game-kit - Make games with React - Interview with Ken Wheeler</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
            docsearch({
              apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
              indexName: 'survivejs_webpack',
              inputSelector: '#search',
              debug: false
            });
          </script></div></main></body></html>