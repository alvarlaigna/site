<html lang="en"><head><title>Setting Environment Variables</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
Sometimes a part of your code should execute only during development. Or you might have experimental features in your build that are not ready for production yet. This code should not end up in the production build.

As JavaScript minifiers can remove dead code (if (false)), we can build on top of â€¦"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/firewood.jpg);"></div><h1 class="post__heading">Setting Environment Variables</h1><div class="header-extra"><a href="https://pixabay.com/en/firewood-combs-thread-cutting-1157304/">cocoparisienne (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="search-nav--header">Search</h4><input id="search"/><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/foreword">Foreword</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/preface">Preface</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/what-is-webpack">What is Webpack?</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing">Developing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/configuring-hmr">Configuring Hot Module Replacement</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/linting">Linting JavaScript</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/composing-configuration">Composing Configuration</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/styling">Styling</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/loading">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/autoprefixing">Autoprefixing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/eliminating-unused-css">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/linting">Linting CSS</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading">Loading</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/fonts">Loading Fonts</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/javascript">Loading JavaScript</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building">Building</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/source-maps">Source Maps</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/splitting-bundles">Splitting Bundles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/code-splitting">Code Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/tidying-up">Tidying Up</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimizing">Optimizing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/minifying">Minifying Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/tree-shaking">Tree Shaking</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Setting Environment Variables</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/adding-hashes-to-filenames">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/separating-manifest">Separating a Manifest</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/performance">Performance</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/output">Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/targets">Build Targets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/library-output">Library Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/multiple-pages">Multiple Pages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/server-side-rendering">Server Side Rendering</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/techniques">Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/dynamic-loading">Dynamic Loading</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/web-workers">Web Workers</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/i18n">Internationalization</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/testing">Testing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/deploying">Deploying Applications</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/packages">Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/consuming">Consuming Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/authoring">Authoring Packages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/extending">Extending</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/loaders">Extending with Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/plugins">Extending with Plugins</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/conclusion">Conclusion</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/appendices">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/comparison">Comparison of Build Tools</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/searching-with-react">Searching with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/hmr-with-react">Hot Module Replacement with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/customizing-eslint">Customizing ESLint</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/troubleshooting">Troubleshooting</a></li></ul><div><div class="buy-container"><a href="/webpack/introduction"><img class="sidebar-cover" src="/assets/img/webpack_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img class="sidebar-cover" src="/assets/img/react_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/survivejs-webpack-18">SurviveJS - Webpack - v1.8</a></blockquote><div class="chapter-content"><p>Sometimes a part of your code should execute only during development. Or you might have experimental features in your build that are not ready for production yet. This code should not end up in the production build.</p>
<p>As JavaScript minifiers can remove dead code (<code>if (false)</code>), we can build on top of this idea and write code that gets transformed into this form. Webpack&#39;s <code>DefinePlugin</code> enables replacing <strong>free variables</strong> so that we can convert <code>if (process.env.NODE_ENV === &#39;development&#39;)</code> kind of code to <code>if (true)</code> or <code>if (false)</code> depending on the environment.</p>
<p>You can find packages that rely on this behavior. React is perhaps the most known example of an early adopter of the technique. Using <code>DefinePlugin</code> can bring down the size of your React production build somewhat as a result, and you may see a similar effect with other packages as well.</p>
<h2 class="header"><a class="header-anchor" href="#the-basic-idea-of-defineplugin-" id="the-basic-idea-of-defineplugin-"></a><span class="text">The Basic Idea of <code>DefinePlugin</code></span><a class="header-anchor-select" href="#the-basic-idea-of-defineplugin-">#</a></h2>
<p>To understand the idea of <code>DefinePlugin</code> better, consider the example below:</p>
<pre><code class="lang-javascript"><span class="token keyword" >var</span> foo<span class="token punctuation" >;</span>

<span class="token comment" spellcheck="true">// Not free due to "foo" above, not ok to replace</span>
<span class="token keyword" >if</span> <span class="token punctuation" >(</span>foo <span class="token operator" >===</span> <span class="token string" >'bar'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation" >(</span><span class="token string" >'bar'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token comment" spellcheck="true">// Free since we don't refer to "bar", ok to replace</span>
<span class="token keyword" >if</span> <span class="token punctuation" >(</span>bar <span class="token operator" >===</span> <span class="token string" >'bar'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation" >(</span><span class="token string" >'bar'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>If we replaced <code>bar</code> with a string like <code>&#39;foobar&#39;</code>, then we would end up with code like this:</p>
<pre><code class="lang-javascript"><span class="token keyword" >var</span> foo<span class="token punctuation" >;</span>

<span class="token comment" spellcheck="true">// Not free due to "foo" above, not ok to replace</span>
<span class="token keyword" >if</span> <span class="token punctuation" >(</span>foo <span class="token operator" >===</span> <span class="token string" >'bar'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation" >(</span><span class="token string" >'bar'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token comment" spellcheck="true">// Free since we don't refer to "bar", ok to replace</span>
<span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token string" >'foobar'</span> <span class="token operator" >===</span> <span class="token string" >'bar'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation" >(</span><span class="token string" >'bar'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>Further analysis shows that <code>&#39;foobar&#39; === &#39;bar&#39;</code> equals <code>false</code> so a minifier gives us:</p>
<pre><code class="lang-javascript"><span class="token keyword" >var</span> foo<span class="token punctuation" >;</span>

<span class="token comment" spellcheck="true">// Not free due to "foo" above, not ok to replace</span>
<span class="token keyword" >if</span> <span class="token punctuation" >(</span>foo <span class="token operator" >===</span> <span class="token string" >'bar'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation" >(</span><span class="token string" >'bar'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token comment" spellcheck="true">// Free since we don't refer to "bar", ok to replace</span>
<span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token boolean" >false</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation" >(</span><span class="token string" >'bar'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>And based on this a minifier can eliminate the <code>if</code> statement as it has become dead code:</p>
<pre><code class="lang-javascript"><span class="token keyword" >var</span> foo<span class="token punctuation" >;</span>

<span class="token comment" spellcheck="true">// Not free, not ok to replace</span>
<span class="token keyword" >if</span> <span class="token punctuation" >(</span>foo <span class="token operator" >===</span> <span class="token string" >'bar'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation" >(</span><span class="token string" >'bar'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token comment" spellcheck="true">// if (false) means the block can be dropped entirely</span>
</code></pre>
<p>Elimination is the core idea of <code>DefinePlugin</code>. We can toggle parts of code using this kind of mechanism. A good minifier can perform the analysis for us and enable/disable entire portions of the code as we prefer.</p>
<h2 class="header"><a class="header-anchor" href="#setting-process-env-node_env-" id="setting-process-env-node_env-"></a><span class="text">Setting <code>process.env.NODE_ENV</code></span><a class="header-anchor-select" href="#setting-process-env-node_env-">#</a></h2>
<p>Given we are using React in our project and it happens to use the technique, we can try to enable <code>DefinePlugin</code> and see what it does to our production build.</p>
<p>As before, encapsulate this idea to a function. It is important to note that given the way webpack replaces the free variable, we should push it through <code>JSON.stringify</code>. We&#39;ll end up with a string like <code>&#39;&quot;demo&quot;&#39;</code> and then webpack will insert that into the slots it finds.</p>
<p><strong>webpack.parts.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

exports<span class="token punctuation" >.</span>setFreeVariable <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>key<span class="token punctuation" >,</span> value<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >const</span> env <span class="token operator" >=</span> <span class="token punctuation" >{</span><span class="token punctuation" >}</span><span class="token punctuation" >;</span>
  env<span class="token punctuation" >[</span>key<span class="token punctuation" >]</span> <span class="token operator" >=</span> JSON<span class="token punctuation" >.</span><span class="token function" >stringify</span><span class="token punctuation" >(</span>value<span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword" >return</span> <span class="token punctuation" >{</span>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>DefinePlugin</span><span class="token punctuation" >(</span>env<span class="token punctuation" >)</span><span class="token punctuation" >,</span>
    <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>We can connect this with our configuration like this:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token keyword" >const</span> productionConfig <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<div class="leanpub-insert">
  parts<span class="token punctuation" >.</span><span class="token function" >setFreeVariable</span><span class="token punctuation" >(</span>
    <span class="token string" >'process.env.NODE_ENV'</span><span class="token punctuation" >,</span>
    <span class="token string" >'production'</span>
  <span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
</code></pre>
<p>Execute <code>npm run build</code> and you should see improved results:</p>
<pre><code class="lang-bash">Hash: 6157a17dba9cb0452e20
Version: webpack 2.2.1
Time: 3213ms
                    Asset       Size  Chunks             Chunk Names
                   app.js  808 bytes       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
  fontawesome-webfont.eot     166 kB          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
fontawesome-webfont.woff2    77.2 kB          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
 fontawesome-webfont.woff      98 kB          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
  fontawesome-webfont.svg   22 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
                 logo.png      77 kB          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
                     0.js  175 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
  fontawesome-webfont.ttf     166 kB          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
                vendor.js    24.6 kB       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
                  app.css    2.48 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
                 0.js.map  768 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
               app.js.map    6.45 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
              app.css.map   84 bytes       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
            vendor.js.map     286 kB       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
               index.html  274 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>14<span class="token punctuation" >]</span> ./app/component.js 461 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>15<span class="token punctuation" >]</span> ./app/shake.js 138 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>16<span class="token punctuation" >]</span> ./~/font-awesome/css/font-awesome.css 41 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >..</span>.
</code></pre>
<p>We went from 150 kB to 45 kB, and finally, to 25 kB. The final build is a little faster than the previous one as well.</p>
<p>Given the 25 kB can be served gzipped, it is somewhat reasonable. gzipping will drop around another 40%, and it is well supported by browsers.</p>
<p>It is good to remember that we didn&#39;t include <em>react-dom</em> in this case and that would add around 100 kB to the final result. To get back to these figures, we would have to use a lighter alternative such as Preact or react-lite as discussed at the <a href="/webpack/packages/consuming">Consuming Packages</a> chapter.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i><a href="https://www.npmjs.com/package/babel-plugin-transform-inline-environment-variables">babel-plugin-transform-inline-environment-variables</a> Babel plugin can be used to achieve the same effect. See <a href="https://babeljs.io/docs/plugins/transform-inline-environment-variables/">the official documentation</a> for details. <a href="https://www.npmjs.com/package/babel-plugin-transform-define">babel-plugin-transform-define</a> and <a href="https://www.npmjs.com/package/babel-plugin-minify-replace">babel-plugin-minify-replace</a> are other options.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i><code>webpack.EnvironmentPlugin([&#39;NODE_ENV&#39;])</code> is a shortcut that allows you to refer to environment variables. It uses <code>DefinePlugin</code> internally and can be useful by itself in more limited cases. You can achieve the same effect by passing <code>process.env.NODE_ENV</code> to the custom function we made.</blockquote><h2 class="header"><a class="header-anchor" href="#choosing-which-module-to-use-based-on-the-environment" id="choosing-which-module-to-use-based-on-the-environment"></a><span class="text">Choosing Which Module to Use Based on the Environment</span><a class="header-anchor-select" href="#choosing-which-module-to-use-based-on-the-environment">#</a></h2>
<p>The techniques discussed in this chapter can be useful for choosing entire modules depending on the environment. As seen above, <code>DefinePlugin</code> based splitting allows us to choose which branch of code to use and which to discard. This idea can be used to implement branching on module level. Consider the file structure below:</p>
<pre><code class="lang-bash"><span class="token keyword" >.</span>
â””â”€â”€ store
    â”œâ”€â”€ index.js
    â”œâ”€â”€ store.dev.js
    â””â”€â”€ store.prod.js
</code></pre>
<p>The idea is that we will choose either <code>dev</code> or <code>prod</code> version of the store depending on the environment. It&#39;s that <em>index.js</em> which does the hard work like this:</p>
<pre><code class="lang-javascript"><span class="token keyword" >if</span><span class="token punctuation" >(</span>process<span class="token punctuation" >.</span>env<span class="token punctuation" >.</span>NODE_ENV <span class="token operator" >===</span> <span class="token string" >'production'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./store.prod'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token punctuation" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./store.dev'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>Webpack can pick the right code based on our <code>DefinePlugin</code> declaration and this code. It is good to note that we will have to use CommonJS module definition style here: ES6 <code>import</code>s don&#39;t allow dynamic behavior like this by design.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>A related technique, <strong>aliasing</strong>, is discussed at the <a href="/webpack/packages/consuming">Consuming Packages</a> chapter. You could alias to development or production particular file depending on the environment. The problem is that it will tie your setup to webpack in a tighter way than the solution above.</blockquote><h2 class="header"><a class="header-anchor" href="#webpack-optimization-plugins" id="webpack-optimization-plugins"></a><span class="text">Webpack Optimization Plugins</span><a class="header-anchor-select" href="#webpack-optimization-plugins">#</a></h2>
<p>Webpack includes a collection of optimization related plugins, some of which we&#39;ll cover in detail in this book. Also, there are some outside the core. I&#39;ve listed the most important ones below:</p>
<ul>
<li><a href="https://www.npmjs.com/package/compression-webpack-plugin">compression-webpack-plugin</a> allows you to push the problem of generating compressed files to webpack to potentially save processing time on the server.</li>
<li><code>webpack.optimize.UglifyJsPlugin</code> allows you to minify output using different heuristics. Some of them might break code unless you are careful.</li>
<li><code>webpack.optimize.AggressiveSplittingPlugin</code> allows you to split code into smaller bundles as discussed at the <a href="/webpack/building/splitting-bundles">Splitting Bundles</a> chapter. The result can be particularly useful in a HTTP/2 environment.</li>
<li><code>webpack.optimize.CommonsChunkPlugin</code> makes it possible to extract common dependencies into bundles of their own.</li>
<li><code>webpack.DefinePlugin</code> allows you to use feature flags in your code and eliminate the redundant code as discussed in this chapter.</li>
<li><a href="https://www.npmjs.com/package/lodash-webpack-plugin">lodash-webpack-plugin</a> creates smaller Lodash builds by replacing feature sets with smaller alternatives leading to more compact builds.</li>
</ul>
<h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Even though simply setting <code>process.env.NODE_ENV</code> the right way can help a lot especially with React-related code, we can do better. Currently, our build doesn&#39;t benefit on client level cache invalidation.</p>
<p>To achieve this result, the build requires placeholders in which webpack can insert hashes that invalidate the files as we update the application.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/trees.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/optimizing/tree-shaking">Tree Shaking</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/hash.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/optimizing/adding-hashes-to-filenames">Adding Hashes to Filenames</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-webpack">available through Leanpub</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of Webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Adding Hashes to Filenames" href="/webpack/optimizing/adding-hashes-to-filenames"><i class="icon-right-open"></i></a><a class="previous-page" title="Tree Shaking" href="/webpack/optimizing/tree-shaking"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><a href="https://github.com/survivejs/webpack" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="position:absolute;top:0;fill:#000;right:0;"><path class="octo-banner" d="M0 0l115 115h15l12 27 108 108V0z" fill="#fff"></path><path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin:130px 106px;transform-origin:130px 106px;"></path><path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"></path></svg></a><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/survivejs-webpack-18">SurviveJS - Webpack - v1.8</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-170">SurviveJS - Webpack - v1.7.0</a></li><li><a class="blog-teaser" href="/blog/unexpected-interview">Unexpected - The Extensible BDD Assertion Toolkit - Interview with Sune Simonsen</a></li><li><a class="blog-teaser" href="/blog/ajv-interview">ajv - The Fastest JSON Schema Validator - Interview with Evgeny Poberezkin</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-160">SurviveJS - Webpack - v1.6.0</a></li><li><a class="blog-teaser" href="/blog/isomorphic-webpack-interview">isomorphic-webpack - Universal module consumption using webpack - Interview with Gajus Kuizinas</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-150">SurviveJS - Webpack - v1.5.0</a></li><li><a class="blog-teaser" href="/blog/styletron-interview">Styletron - Universal, high-performance JavaScript styles - Interview with Ryan Tsao</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-142">SurviveJS - Webpack - v1.4.2</a></li><li><a class="blog-teaser" href="/blog/inferno-interview">Inferno - Blazing fast, React-like UI library - Interview with Dominic Gannaway</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
            docsearch({
              apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
              indexName: 'survivejs_webpack',
              inputSelector: '#search',
              debug: false
            });
          </script></div></main></body></html>